"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.StaticTransportStrategy = exports.StaticGrpcConfiguration = void 0;
class StaticGrpcConfiguration {
    constructor(props) {
        this.deadlineMillis = props.deadlineMillis;
        this.maxSessionMemoryMb = props.maxSessionMemoryMb;
        if (props.numClients !== undefined && props.numClients !== null) {
            this.numClients = props.numClients;
        }
        else {
            // This is the previously hardcoded value and a safe default for most environments.
            this.numClients = 6;
        }
    }
    getDeadlineMillis() {
        return this.deadlineMillis;
    }
    getMaxSessionMemoryMb() {
        return this.maxSessionMemoryMb;
    }
    withDeadlineMillis(deadlineMillis) {
        return new StaticGrpcConfiguration({
            deadlineMillis: deadlineMillis,
            maxSessionMemoryMb: this.maxSessionMemoryMb,
            numClients: this.numClients,
        });
    }
    withMaxSessionMemoryMb(maxSessionMemoryMb) {
        return new StaticGrpcConfiguration({
            deadlineMillis: this.deadlineMillis,
            maxSessionMemoryMb: maxSessionMemoryMb,
            numClients: this.numClients,
        });
    }
    getNumClients() {
        return this.numClients;
    }
    withNumClients(numClients) {
        return new StaticGrpcConfiguration({
            deadlineMillis: this.deadlineMillis,
            maxSessionMemoryMb: this.maxSessionMemoryMb,
            numClients: numClients,
        });
    }
}
exports.StaticGrpcConfiguration = StaticGrpcConfiguration;
class StaticTransportStrategy {
    constructor(props) {
        this.grpcConfig = props.grpcConfiguration;
        this.maxIdleMillis = props.maxIdleMillis;
    }
    getGrpcConfig() {
        return this.grpcConfig;
    }
    withGrpcConfig(grpcConfig) {
        return new StaticTransportStrategy({
            grpcConfiguration: grpcConfig,
            maxIdleMillis: this.maxIdleMillis,
        });
    }
    getMaxIdleMillis() {
        return this.maxIdleMillis;
    }
    withMaxIdleMillis(maxIdleMillis) {
        return new StaticTransportStrategy({
            grpcConfiguration: this.grpcConfig,
            maxIdleMillis: maxIdleMillis,
        });
    }
    withClientTimeoutMillis(clientTimeout) {
        return new StaticTransportStrategy({
            grpcConfiguration: this.grpcConfig.withDeadlineMillis(clientTimeout),
            maxIdleMillis: this.maxIdleMillis,
        });
    }
}
exports.StaticTransportStrategy = StaticTransportStrategy;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidHJhbnNwb3J0LXN0cmF0ZWd5LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL2NvbmZpZy90cmFuc3BvcnQvdHJhbnNwb3J0LXN0cmF0ZWd5LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQTREQSxNQUFhLHVCQUF1QjtJQUlsQyxZQUFZLEtBQTZCO1FBQ3ZDLElBQUksQ0FBQyxjQUFjLEdBQUcsS0FBSyxDQUFDLGNBQWMsQ0FBQztRQUMzQyxJQUFJLENBQUMsa0JBQWtCLEdBQUcsS0FBSyxDQUFDLGtCQUFrQixDQUFDO1FBQ25ELElBQUksS0FBSyxDQUFDLFVBQVUsS0FBSyxTQUFTLElBQUksS0FBSyxDQUFDLFVBQVUsS0FBSyxJQUFJLEVBQUU7WUFDL0QsSUFBSSxDQUFDLFVBQVUsR0FBRyxLQUFLLENBQUMsVUFBVSxDQUFDO1NBQ3BDO2FBQU07WUFDTCxtRkFBbUY7WUFDbkYsSUFBSSxDQUFDLFVBQVUsR0FBRyxDQUFDLENBQUM7U0FDckI7SUFDSCxDQUFDO0lBRUQsaUJBQWlCO1FBQ2YsT0FBTyxJQUFJLENBQUMsY0FBYyxDQUFDO0lBQzdCLENBQUM7SUFFRCxxQkFBcUI7UUFDbkIsT0FBTyxJQUFJLENBQUMsa0JBQWtCLENBQUM7SUFDakMsQ0FBQztJQUVELGtCQUFrQixDQUFDLGNBQXNCO1FBQ3ZDLE9BQU8sSUFBSSx1QkFBdUIsQ0FBQztZQUNqQyxjQUFjLEVBQUUsY0FBYztZQUM5QixrQkFBa0IsRUFBRSxJQUFJLENBQUMsa0JBQWtCO1lBQzNDLFVBQVUsRUFBRSxJQUFJLENBQUMsVUFBVTtTQUM1QixDQUFDLENBQUM7SUFDTCxDQUFDO0lBRUQsc0JBQXNCLENBQUMsa0JBQTBCO1FBQy9DLE9BQU8sSUFBSSx1QkFBdUIsQ0FBQztZQUNqQyxjQUFjLEVBQUUsSUFBSSxDQUFDLGNBQWM7WUFDbkMsa0JBQWtCLEVBQUUsa0JBQWtCO1lBQ3RDLFVBQVUsRUFBRSxJQUFJLENBQUMsVUFBVTtTQUM1QixDQUFDLENBQUM7SUFDTCxDQUFDO0lBRUQsYUFBYTtRQUNYLE9BQU8sSUFBSSxDQUFDLFVBQVUsQ0FBQztJQUN6QixDQUFDO0lBRUQsY0FBYyxDQUFDLFVBQWtCO1FBQy9CLE9BQU8sSUFBSSx1QkFBdUIsQ0FBQztZQUNqQyxjQUFjLEVBQUUsSUFBSSxDQUFDLGNBQWM7WUFDbkMsa0JBQWtCLEVBQUUsSUFBSSxDQUFDLGtCQUFrQjtZQUMzQyxVQUFVLEVBQUUsVUFBVTtTQUN2QixDQUFDLENBQUM7SUFDTCxDQUFDO0NBQ0Y7QUFsREQsMERBa0RDO0FBRUQsTUFBYSx1QkFBdUI7SUFJbEMsWUFBWSxLQUE2QjtRQUN2QyxJQUFJLENBQUMsVUFBVSxHQUFHLEtBQUssQ0FBQyxpQkFBaUIsQ0FBQztRQUMxQyxJQUFJLENBQUMsYUFBYSxHQUFHLEtBQUssQ0FBQyxhQUFhLENBQUM7SUFDM0MsQ0FBQztJQUVELGFBQWE7UUFDWCxPQUFPLElBQUksQ0FBQyxVQUFVLENBQUM7SUFDekIsQ0FBQztJQUVELGNBQWMsQ0FBQyxVQUE2QjtRQUMxQyxPQUFPLElBQUksdUJBQXVCLENBQUM7WUFDakMsaUJBQWlCLEVBQUUsVUFBVTtZQUM3QixhQUFhLEVBQUUsSUFBSSxDQUFDLGFBQWE7U0FDbEMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUVELGdCQUFnQjtRQUNkLE9BQU8sSUFBSSxDQUFDLGFBQWEsQ0FBQztJQUM1QixDQUFDO0lBRUQsaUJBQWlCLENBQUMsYUFBcUI7UUFDckMsT0FBTyxJQUFJLHVCQUF1QixDQUFDO1lBQ2pDLGlCQUFpQixFQUFFLElBQUksQ0FBQyxVQUFVO1lBQ2xDLGFBQWEsRUFBRSxhQUFhO1NBQzdCLENBQUMsQ0FBQztJQUNMLENBQUM7SUFFRCx1QkFBdUIsQ0FBQyxhQUFxQjtRQUMzQyxPQUFPLElBQUksdUJBQXVCLENBQUM7WUFDakMsaUJBQWlCLEVBQUUsSUFBSSxDQUFDLFVBQVUsQ0FBQyxrQkFBa0IsQ0FBQyxhQUFhLENBQUM7WUFDcEUsYUFBYSxFQUFFLElBQUksQ0FBQyxhQUFhO1NBQ2xDLENBQUMsQ0FBQztJQUNMLENBQUM7Q0FDRjtBQXJDRCwwREFxQ0MiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge0dycGNDb25maWd1cmF0aW9uLCBHcnBjQ29uZmlndXJhdGlvblByb3BzfSBmcm9tICcuL2dycGMtY29uZmlndXJhdGlvbic7XG5cbmV4cG9ydCBpbnRlcmZhY2UgVHJhbnNwb3J0U3RyYXRlZ3kge1xuICAvKipcbiAgICogQ29uZmlndXJlcyB0aGUgbG93LWxldmVsIGdSUEMgc2V0dGluZ3MgZm9yIHRoZSBNb21lbnRvIGNsaWVudCdzIGNvbW11bmljYXRpb25cbiAgICogd2l0aCB0aGUgTW9tZW50byBzZXJ2ZXIuXG4gICAqIEByZXR1cm5zIHtHcnBjQ29uZmlndXJhdGlvbn1cbiAgICovXG4gIGdldEdycGNDb25maWcoKTogR3JwY0NvbmZpZ3VyYXRpb247XG5cbiAgLyoqXG4gICAqIENvcHkgY29uc3RydWN0b3IgZm9yIG92ZXJyaWRpbmcgdGhlIGdSUEMgY29uZmlndXJhdGlvblxuICAgKiBAcGFyYW0ge0dycGNDb25maWd1cmF0aW9ufSBncnBjQ29uZmlnXG4gICAqIEByZXR1cm5zIHtUcmFuc3BvcnRTdHJhdGVneX0gYSBuZXcgVHJhbnNwb3J0U3RyYXRlZ3kgd2l0aCB0aGUgc3BlY2lmaWVkIGdSUEMgY29uZmlnLlxuICAgKi9cbiAgd2l0aEdycGNDb25maWcoZ3JwY0NvbmZpZzogR3JwY0NvbmZpZ3VyYXRpb24pOiBUcmFuc3BvcnRTdHJhdGVneTtcblxuICAvKipcbiAgICogQ29weSBjb25zdHJ1Y3RvciB0byB1cGRhdGUgdGhlIGNsaWVudC1zaWRlIHRpbWVvdXRcbiAgICogQHBhcmFtIHtudW1iZXJ9IGNsaWVudFRpbWVvdXRNaWxsaXNcbiAgICogQHJldHVybnMge1RyYW5zcG9ydFN0cmF0ZWd5fSBhIG5ldyBUcmFuc3BvcnRTdHJhdGVneSB3aXRoIHRoZSBzcGVjaWZpZWQgY2xpZW50IHRpbWVvdXRcbiAgICovXG4gIHdpdGhDbGllbnRUaW1lb3V0TWlsbGlzKGNsaWVudFRpbWVvdXRNaWxsaXM6IG51bWJlcik6IFRyYW5zcG9ydFN0cmF0ZWd5O1xuXG4gIC8qKlxuICAgKiBUaGUgbWF4aW11bSBkdXJhdGlvbiBmb3Igd2hpY2ggYSBjb25uZWN0aW9uIG1heSByZW1haW4gaWRsZSBiZWZvcmUgYmVpbmcgcmVwbGFjZWQuICBUaGlzXG4gICAqIHNldHRpbmcgY2FuIGJlIHVzZWQgdG8gZm9yY2UgcmUtY29ubmVjdGlvbiBvZiBhIGNsaWVudCBpZiBpdCBoYXMgYmVlbiBpZGxlIGZvciB0b28gbG9uZy5cbiAgICogSW4gZW52aXJvbm1lbnRzIHN1Y2ggYXMgQVdTIGxhbWJkYSwgaWYgdGhlIGxhbWJkYSBpcyBzdXNwZW5kZWQgZm9yIHRvbyBsb25nIHRoZSBjb25uZWN0aW9uXG4gICAqIG1heSBiZSBjbG9zZWQgYnkgdGhlIGxvYWQgYmFsYW5jZXIsIHJlc3VsdGluZyBpbiBhbiBlcnJvciBvbiB0aGUgc3Vic2VxdWVudCByZXF1ZXN0LiAgSWZcbiAgICogdGhpcyBzZXR0aW5nIGlzIHNldCB0byBhIGR1cmF0aW9uIGxlc3MgdGhhbiB0aGUgbG9hZCBiYWxhbmNlciB0aW1lb3V0LCB3ZSBjYW4gZW5zdXJlIHRoYXRcbiAgICogdGhlIGNvbm5lY3Rpb24gd2lsbCBiZSByZWZyZXNoZWQgdG8gYXZvaWQgZXJyb3JzLlxuICAgKiBAcmV0dXJucyB7bnVtYmVyfVxuICAgKi9cbiAgZ2V0TWF4SWRsZU1pbGxpcygpOiBudW1iZXI7XG5cbiAgLyoqXG4gICAqIENvcHkgY29uc3RydWN0b3IgdG8gdXBkYXRlIHRoZSBtYXggaWRsZSBjb25uZWN0aW9uIHRpbWVvdXQuICAoU2VlIHtnZXRNYXhJZGxlTWlsbGlzfS4pXG4gICAqIEBwYXJhbSB7bnVtYmVyfSBtYXhJZGxlTWlsbGlzXG4gICAqIEByZXR1cm5zIHtUcmFuc3BvcnRTdHJhdGVneX0gYSBuZXcgVHJhbnNwb3J0U3RyYXRlZ3kgd2l0aCB0aGUgc3BlY2lmaWVkIG1heCBpZGxlIGNvbm5lY3Rpb24gdGltZW91dC5cbiAgICovXG4gIHdpdGhNYXhJZGxlTWlsbGlzKG1heElkbGVNaWxsaXM6IG51bWJlcik6IFRyYW5zcG9ydFN0cmF0ZWd5O1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFRyYW5zcG9ydFN0cmF0ZWd5UHJvcHMge1xuICAvKipcbiAgICogbG93LWxldmVsIGdSUEMgc2V0dGluZ3MgZm9yIGNvbW11bmljYXRpb24gd2l0aCB0aGUgTW9tZW50byBzZXJ2ZXJcbiAgICovXG4gIGdycGNDb25maWd1cmF0aW9uOiBHcnBjQ29uZmlndXJhdGlvbjtcbiAgLyoqXG4gICAqIFRoZSBtYXhpbXVtIGR1cmF0aW9uIGZvciB3aGljaCBhIGNvbm5lY3Rpb24gbWF5IHJlbWFpbiBpZGxlIGJlZm9yZSBiZWluZyByZXBsYWNlZC4gIFRoaXNcbiAgICogc2V0dGluZyBjYW4gYmUgdXNlZCB0byBmb3JjZSByZS1jb25uZWN0aW9uIG9mIGEgY2xpZW50IGlmIGl0IGhhcyBiZWVuIGlkbGUgZm9yIHRvbyBsb25nLlxuICAgKiBJbiBlbnZpcm9ubWVudHMgc3VjaCBhcyBBV1MgbGFtYmRhLCBpZiB0aGUgbGFtYmRhIGlzIHN1c3BlbmRlZCBmb3IgdG9vIGxvbmcgdGhlIGNvbm5lY3Rpb25cbiAgICogbWF5IGJlIGNsb3NlZCBieSB0aGUgbG9hZCBiYWxhbmNlciwgcmVzdWx0aW5nIGluIGFuIGVycm9yIG9uIHRoZSBzdWJzZXF1ZW50IHJlcXVlc3QuICBJZlxuICAgKiB0aGlzIHNldHRpbmcgaXMgc2V0IHRvIGEgZHVyYXRpb24gbGVzcyB0aGFuIHRoZSBsb2FkIGJhbGFuY2VyIHRpbWVvdXQsIHdlIGNhbiBlbnN1cmUgdGhhdFxuICAgKiB0aGUgY29ubmVjdGlvbiB3aWxsIGJlIHJlZnJlc2hlZCB0byBhdm9pZCBlcnJvcnMuXG4gICAqIEByZXR1cm5zIHtudW1iZXJ9XG4gICAqL1xuICBtYXhJZGxlTWlsbGlzOiBudW1iZXI7XG59XG5cbmV4cG9ydCBjbGFzcyBTdGF0aWNHcnBjQ29uZmlndXJhdGlvbiBpbXBsZW1lbnRzIEdycGNDb25maWd1cmF0aW9uIHtcbiAgcHJpdmF0ZSByZWFkb25seSBkZWFkbGluZU1pbGxpczogbnVtYmVyO1xuICBwcml2YXRlIHJlYWRvbmx5IG1heFNlc3Npb25NZW1vcnlNYjogbnVtYmVyO1xuICBwcml2YXRlIHJlYWRvbmx5IG51bUNsaWVudHM6IG51bWJlcjtcbiAgY29uc3RydWN0b3IocHJvcHM6IEdycGNDb25maWd1cmF0aW9uUHJvcHMpIHtcbiAgICB0aGlzLmRlYWRsaW5lTWlsbGlzID0gcHJvcHMuZGVhZGxpbmVNaWxsaXM7XG4gICAgdGhpcy5tYXhTZXNzaW9uTWVtb3J5TWIgPSBwcm9wcy5tYXhTZXNzaW9uTWVtb3J5TWI7XG4gICAgaWYgKHByb3BzLm51bUNsaWVudHMgIT09IHVuZGVmaW5lZCAmJiBwcm9wcy5udW1DbGllbnRzICE9PSBudWxsKSB7XG4gICAgICB0aGlzLm51bUNsaWVudHMgPSBwcm9wcy5udW1DbGllbnRzO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyBUaGlzIGlzIHRoZSBwcmV2aW91c2x5IGhhcmRjb2RlZCB2YWx1ZSBhbmQgYSBzYWZlIGRlZmF1bHQgZm9yIG1vc3QgZW52aXJvbm1lbnRzLlxuICAgICAgdGhpcy5udW1DbGllbnRzID0gNjtcbiAgICB9XG4gIH1cblxuICBnZXREZWFkbGluZU1pbGxpcygpOiBudW1iZXIge1xuICAgIHJldHVybiB0aGlzLmRlYWRsaW5lTWlsbGlzO1xuICB9XG5cbiAgZ2V0TWF4U2Vzc2lvbk1lbW9yeU1iKCk6IG51bWJlciB7XG4gICAgcmV0dXJuIHRoaXMubWF4U2Vzc2lvbk1lbW9yeU1iO1xuICB9XG5cbiAgd2l0aERlYWRsaW5lTWlsbGlzKGRlYWRsaW5lTWlsbGlzOiBudW1iZXIpOiBTdGF0aWNHcnBjQ29uZmlndXJhdGlvbiB7XG4gICAgcmV0dXJuIG5ldyBTdGF0aWNHcnBjQ29uZmlndXJhdGlvbih7XG4gICAgICBkZWFkbGluZU1pbGxpczogZGVhZGxpbmVNaWxsaXMsXG4gICAgICBtYXhTZXNzaW9uTWVtb3J5TWI6IHRoaXMubWF4U2Vzc2lvbk1lbW9yeU1iLFxuICAgICAgbnVtQ2xpZW50czogdGhpcy5udW1DbGllbnRzLFxuICAgIH0pO1xuICB9XG5cbiAgd2l0aE1heFNlc3Npb25NZW1vcnlNYihtYXhTZXNzaW9uTWVtb3J5TWI6IG51bWJlcik6IFN0YXRpY0dycGNDb25maWd1cmF0aW9uIHtcbiAgICByZXR1cm4gbmV3IFN0YXRpY0dycGNDb25maWd1cmF0aW9uKHtcbiAgICAgIGRlYWRsaW5lTWlsbGlzOiB0aGlzLmRlYWRsaW5lTWlsbGlzLFxuICAgICAgbWF4U2Vzc2lvbk1lbW9yeU1iOiBtYXhTZXNzaW9uTWVtb3J5TWIsXG4gICAgICBudW1DbGllbnRzOiB0aGlzLm51bUNsaWVudHMsXG4gICAgfSk7XG4gIH1cblxuICBnZXROdW1DbGllbnRzKCk6IG51bWJlciB7XG4gICAgcmV0dXJuIHRoaXMubnVtQ2xpZW50cztcbiAgfVxuXG4gIHdpdGhOdW1DbGllbnRzKG51bUNsaWVudHM6IG51bWJlcik6IEdycGNDb25maWd1cmF0aW9uIHtcbiAgICByZXR1cm4gbmV3IFN0YXRpY0dycGNDb25maWd1cmF0aW9uKHtcbiAgICAgIGRlYWRsaW5lTWlsbGlzOiB0aGlzLmRlYWRsaW5lTWlsbGlzLFxuICAgICAgbWF4U2Vzc2lvbk1lbW9yeU1iOiB0aGlzLm1heFNlc3Npb25NZW1vcnlNYixcbiAgICAgIG51bUNsaWVudHM6IG51bUNsaWVudHMsXG4gICAgfSk7XG4gIH1cbn1cblxuZXhwb3J0IGNsYXNzIFN0YXRpY1RyYW5zcG9ydFN0cmF0ZWd5IGltcGxlbWVudHMgVHJhbnNwb3J0U3RyYXRlZ3kge1xuICBwcml2YXRlIHJlYWRvbmx5IGdycGNDb25maWc6IEdycGNDb25maWd1cmF0aW9uO1xuICBwcml2YXRlIHJlYWRvbmx5IG1heElkbGVNaWxsaXM6IG51bWJlcjtcblxuICBjb25zdHJ1Y3Rvcihwcm9wczogVHJhbnNwb3J0U3RyYXRlZ3lQcm9wcykge1xuICAgIHRoaXMuZ3JwY0NvbmZpZyA9IHByb3BzLmdycGNDb25maWd1cmF0aW9uO1xuICAgIHRoaXMubWF4SWRsZU1pbGxpcyA9IHByb3BzLm1heElkbGVNaWxsaXM7XG4gIH1cblxuICBnZXRHcnBjQ29uZmlnKCk6IEdycGNDb25maWd1cmF0aW9uIHtcbiAgICByZXR1cm4gdGhpcy5ncnBjQ29uZmlnO1xuICB9XG5cbiAgd2l0aEdycGNDb25maWcoZ3JwY0NvbmZpZzogR3JwY0NvbmZpZ3VyYXRpb24pOiBTdGF0aWNUcmFuc3BvcnRTdHJhdGVneSB7XG4gICAgcmV0dXJuIG5ldyBTdGF0aWNUcmFuc3BvcnRTdHJhdGVneSh7XG4gICAgICBncnBjQ29uZmlndXJhdGlvbjogZ3JwY0NvbmZpZyxcbiAgICAgIG1heElkbGVNaWxsaXM6IHRoaXMubWF4SWRsZU1pbGxpcyxcbiAgICB9KTtcbiAgfVxuXG4gIGdldE1heElkbGVNaWxsaXMoKTogbnVtYmVyIHtcbiAgICByZXR1cm4gdGhpcy5tYXhJZGxlTWlsbGlzO1xuICB9XG5cbiAgd2l0aE1heElkbGVNaWxsaXMobWF4SWRsZU1pbGxpczogbnVtYmVyKTogVHJhbnNwb3J0U3RyYXRlZ3kge1xuICAgIHJldHVybiBuZXcgU3RhdGljVHJhbnNwb3J0U3RyYXRlZ3koe1xuICAgICAgZ3JwY0NvbmZpZ3VyYXRpb246IHRoaXMuZ3JwY0NvbmZpZyxcbiAgICAgIG1heElkbGVNaWxsaXM6IG1heElkbGVNaWxsaXMsXG4gICAgfSk7XG4gIH1cblxuICB3aXRoQ2xpZW50VGltZW91dE1pbGxpcyhjbGllbnRUaW1lb3V0OiBudW1iZXIpOiBTdGF0aWNUcmFuc3BvcnRTdHJhdGVneSB7XG4gICAgcmV0dXJuIG5ldyBTdGF0aWNUcmFuc3BvcnRTdHJhdGVneSh7XG4gICAgICBncnBjQ29uZmlndXJhdGlvbjogdGhpcy5ncnBjQ29uZmlnLndpdGhEZWFkbGluZU1pbGxpcyhjbGllbnRUaW1lb3V0KSxcbiAgICAgIG1heElkbGVNaWxsaXM6IHRoaXMubWF4SWRsZU1pbGxpcyxcbiAgICB9KTtcbiAgfVxufVxuIl19