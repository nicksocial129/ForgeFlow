{"ast":null,"code":"import{useEffect,useState}from'react';import{FullPageChat}from'flowise-embed-react';import{useNavigate}from'react-router-dom';// Project import\nimport LoginDialog from'ui-component/dialog/LoginDialog';// API\nimport chatflowsApi from'api/chatflows';// Hooks\nimport useApi from'hooks/useApi';//Const\nimport{baseURL}from'store/constant';// ==============================|| Chatbot ||============================== //\nimport{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";const ChatbotFull=()=>{const URLpath=document.location.pathname.toString().split('/');const chatflowId=URLpath[URLpath.length-1]==='chatbot'?'':URLpath[URLpath.length-1];const navigate=useNavigate();const[chatflow,setChatflow]=useState(null);const[chatbotTheme,setChatbotTheme]=useState({});const[loginDialogOpen,setLoginDialogOpen]=useState(false);const[loginDialogProps,setLoginDialogProps]=useState({});const[isLoading,setLoading]=useState(true);const[chatbotOverrideConfig,setChatbotOverrideConfig]=useState({});const getSpecificChatflowFromPublicApi=useApi(chatflowsApi.getSpecificChatflowFromPublicEndpoint);const getSpecificChatflowApi=useApi(chatflowsApi.getSpecificChatflow);const onLoginClick=(username,password)=>{localStorage.setItem('username',username);localStorage.setItem('password',password);navigate(0);};useEffect(()=>{getSpecificChatflowFromPublicApi.request(chatflowId);// eslint-disable-next-line react-hooks/exhaustive-deps\n},[]);useEffect(()=>{if(getSpecificChatflowFromPublicApi.error){var _getSpecificChatflowF,_getSpecificChatflowF2;if(((_getSpecificChatflowF=getSpecificChatflowFromPublicApi.error)===null||_getSpecificChatflowF===void 0?void 0:(_getSpecificChatflowF2=_getSpecificChatflowF.response)===null||_getSpecificChatflowF2===void 0?void 0:_getSpecificChatflowF2.status)===401){if(localStorage.getItem('username')&&localStorage.getItem('password')){getSpecificChatflowApi.request(chatflowId);}else{setLoginDialogProps({title:'Login',confirmButtonName:'Login'});setLoginDialogOpen(true);}}}// eslint-disable-next-line react-hooks/exhaustive-deps\n},[getSpecificChatflowFromPublicApi.error]);useEffect(()=>{if(getSpecificChatflowApi.error){var _getSpecificChatflowA,_getSpecificChatflowA2;if(((_getSpecificChatflowA=getSpecificChatflowApi.error)===null||_getSpecificChatflowA===void 0?void 0:(_getSpecificChatflowA2=_getSpecificChatflowA.response)===null||_getSpecificChatflowA2===void 0?void 0:_getSpecificChatflowA2.status)===401){setLoginDialogProps({title:'Login',confirmButtonName:'Login'});setLoginDialogOpen(true);}}},[getSpecificChatflowApi.error]);useEffect(()=>{if(getSpecificChatflowFromPublicApi.data||getSpecificChatflowApi.data){const chatflowData=getSpecificChatflowFromPublicApi.data||getSpecificChatflowApi.data;setChatflow(chatflowData);if(chatflowData.chatbotConfig){try{const parsedConfig=JSON.parse(chatflowData.chatbotConfig);setChatbotTheme(parsedConfig);if(parsedConfig.overrideConfig){// Generate new sessionId\nif(parsedConfig.overrideConfig.generateNewSession){parsedConfig.overrideConfig.sessionId=Date.now().toString();}setChatbotOverrideConfig(parsedConfig.overrideConfig);}}catch(e){console.error(e);setChatbotTheme({});setChatbotOverrideConfig({});}}}},[getSpecificChatflowFromPublicApi.data,getSpecificChatflowApi.data]);useEffect(()=>{setLoading(getSpecificChatflowFromPublicApi.loading||getSpecificChatflowApi.loading);},[getSpecificChatflowFromPublicApi.loading,getSpecificChatflowApi.loading]);return/*#__PURE__*/_jsx(_Fragment,{children:!isLoading?/*#__PURE__*/_jsxs(_Fragment,{children:[!chatflow||chatflow.apikeyid?/*#__PURE__*/_jsx(\"p\",{children:\"Invalid Chatbot\"}):/*#__PURE__*/_jsx(FullPageChat,{chatflowid:chatflow.id,apiHost:baseURL,chatflowConfig:chatbotOverrideConfig,theme:{chatWindow:chatbotTheme}}),/*#__PURE__*/_jsx(LoginDialog,{show:loginDialogOpen,dialogProps:loginDialogProps,onConfirm:onLoginClick})]}):null});};export default ChatbotFull;","map":{"version":3,"names":["useEffect","useState","FullPageChat","useNavigate","LoginDialog","chatflowsApi","useApi","baseURL","jsx","_jsx","Fragment","_Fragment","jsxs","_jsxs","ChatbotFull","URLpath","document","location","pathname","toString","split","chatflowId","length","navigate","chatflow","setChatflow","chatbotTheme","setChatbotTheme","loginDialogOpen","setLoginDialogOpen","loginDialogProps","setLoginDialogProps","isLoading","setLoading","chatbotOverrideConfig","setChatbotOverrideConfig","getSpecificChatflowFromPublicApi","getSpecificChatflowFromPublicEndpoint","getSpecificChatflowApi","getSpecificChatflow","onLoginClick","username","password","localStorage","setItem","request","error","_getSpecificChatflowF","_getSpecificChatflowF2","response","status","getItem","title","confirmButtonName","_getSpecificChatflowA","_getSpecificChatflowA2","data","chatflowData","chatbotConfig","parsedConfig","JSON","parse","overrideConfig","generateNewSession","sessionId","Date","now","e","console","loading","children","apikeyid","chatflowid","id","apiHost","chatflowConfig","theme","chatWindow","show","dialogProps","onConfirm"],"sources":["/Users/nickprince/Desktop/Flowise Working Commit/packages/ui/src/views/chatbot/index.js"],"sourcesContent":["import { useEffect, useState } from 'react'\nimport { FullPageChat } from 'flowise-embed-react'\nimport { useNavigate } from 'react-router-dom'\n\n// Project import\nimport LoginDialog from 'ui-component/dialog/LoginDialog'\n\n// API\nimport chatflowsApi from 'api/chatflows'\n\n// Hooks\nimport useApi from 'hooks/useApi'\n\n//Const\nimport { baseURL } from 'store/constant'\n\n// ==============================|| Chatbot ||============================== //\n\nconst ChatbotFull = () => {\n    const URLpath = document.location.pathname.toString().split('/')\n    const chatflowId = URLpath[URLpath.length - 1] === 'chatbot' ? '' : URLpath[URLpath.length - 1]\n    const navigate = useNavigate()\n\n    const [chatflow, setChatflow] = useState(null)\n    const [chatbotTheme, setChatbotTheme] = useState({})\n    const [loginDialogOpen, setLoginDialogOpen] = useState(false)\n    const [loginDialogProps, setLoginDialogProps] = useState({})\n    const [isLoading, setLoading] = useState(true)\n    const [chatbotOverrideConfig, setChatbotOverrideConfig] = useState({})\n\n    const getSpecificChatflowFromPublicApi = useApi(chatflowsApi.getSpecificChatflowFromPublicEndpoint)\n    const getSpecificChatflowApi = useApi(chatflowsApi.getSpecificChatflow)\n\n    const onLoginClick = (username, password) => {\n        localStorage.setItem('username', username)\n        localStorage.setItem('password', password)\n        navigate(0)\n    }\n\n    useEffect(() => {\n        getSpecificChatflowFromPublicApi.request(chatflowId)\n\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, [])\n\n    useEffect(() => {\n        if (getSpecificChatflowFromPublicApi.error) {\n            if (getSpecificChatflowFromPublicApi.error?.response?.status === 401) {\n                if (localStorage.getItem('username') && localStorage.getItem('password')) {\n                    getSpecificChatflowApi.request(chatflowId)\n                } else {\n                    setLoginDialogProps({\n                        title: 'Login',\n                        confirmButtonName: 'Login'\n                    })\n                    setLoginDialogOpen(true)\n                }\n            }\n        }\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, [getSpecificChatflowFromPublicApi.error])\n\n    useEffect(() => {\n        if (getSpecificChatflowApi.error) {\n            if (getSpecificChatflowApi.error?.response?.status === 401) {\n                setLoginDialogProps({\n                    title: 'Login',\n                    confirmButtonName: 'Login'\n                })\n                setLoginDialogOpen(true)\n            }\n        }\n    }, [getSpecificChatflowApi.error])\n\n    useEffect(() => {\n        if (getSpecificChatflowFromPublicApi.data || getSpecificChatflowApi.data) {\n            const chatflowData = getSpecificChatflowFromPublicApi.data || getSpecificChatflowApi.data\n            setChatflow(chatflowData)\n            if (chatflowData.chatbotConfig) {\n                try {\n                    const parsedConfig = JSON.parse(chatflowData.chatbotConfig)\n                    setChatbotTheme(parsedConfig)\n                    if (parsedConfig.overrideConfig) {\n                        // Generate new sessionId\n                        if (parsedConfig.overrideConfig.generateNewSession) {\n                            parsedConfig.overrideConfig.sessionId = Date.now().toString()\n                        }\n                        setChatbotOverrideConfig(parsedConfig.overrideConfig)\n                    }\n                } catch (e) {\n                    console.error(e)\n                    setChatbotTheme({})\n                    setChatbotOverrideConfig({})\n                }\n            }\n        }\n    }, [getSpecificChatflowFromPublicApi.data, getSpecificChatflowApi.data])\n\n    useEffect(() => {\n        setLoading(getSpecificChatflowFromPublicApi.loading || getSpecificChatflowApi.loading)\n    }, [getSpecificChatflowFromPublicApi.loading, getSpecificChatflowApi.loading])\n\n    return (\n        <>\n            {!isLoading ? (\n                <>\n                    {!chatflow || chatflow.apikeyid ? (\n                        <p>Invalid Chatbot</p>\n                    ) : (\n                        <FullPageChat\n                            chatflowid={chatflow.id}\n                            apiHost={baseURL}\n                            chatflowConfig={chatbotOverrideConfig}\n                            theme={{ chatWindow: chatbotTheme }}\n                        />\n                    )}\n                    <LoginDialog show={loginDialogOpen} dialogProps={loginDialogProps} onConfirm={onLoginClick} />\n                </>\n            ) : null}\n        </>\n    )\n}\n\nexport default ChatbotFull\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}