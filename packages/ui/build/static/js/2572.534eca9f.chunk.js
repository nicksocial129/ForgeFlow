"use strict";(self.webpackChunkflowise_ui=self.webpackChunkflowise_ui||[]).push([[2572],{17904:(e,t,a)=>{a.d(t,{c:()=>o});var n=a(31060);const o={getAllAPIKeys:()=>n.c.get("/apikey"),createNewAPI:e=>n.c.post("/apikey",e),updateAPI:(e,t)=>n.c.put("/apikey/".concat(e),t),deleteAPI:e=>n.c.delete("/apikey/".concat(e))}},39784:(e,t,a)=>{a.d(t,{c:()=>o});var n=a(31060);const o={getAllChatflows:()=>n.c.get("/chatflows"),getSpecificChatflow:e=>n.c.get("/chatflows/".concat(e)),getSpecificChatflowFromPublicEndpoint:e=>n.c.get("/public-chatflows/".concat(e)),createNewChatflow:e=>n.c.post("/chatflows",e),updateChatflow:(e,t)=>n.c.put("/chatflows/".concat(e),t),deleteChatflow:e=>n.c.delete("/chatflows/".concat(e)),getIsChatflowStreaming:e=>n.c.get("/chatflows-streaming/".concat(e))}},80760:(e,t,a)=>{a.d(t,{c:()=>h});var n=a(92572),o=a(59192),s=a(95836),r=a(51515),i=a(78944),c=a(15860),l=a(54528),d=a(12464),u=a(78472),p=a(9e4);const h=e=>{let{show:t,dialogProps:a,onCancel:h,onConfirm:m}=e;const f=document.getElementById("portal"),[g,x]=(0,o.useState)(""),[y,v]=(0,o.useState)(!1);(0,o.useEffect)((()=>{v(!!g)}),[g]);const w=t?(0,p.jsxs)(s.c,{open:t,fullWidth:!0,maxWidth:"xs",onClose:h,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[(0,p.jsx)(r.c,{sx:{fontSize:"1rem"},id:"alert-dialog-title",children:a.title}),(0,p.jsx)(i.c,{children:(0,p.jsx)(c.c,{sx:{mt:1},id:"chatflow-name",type:"text",fullWidth:!0,placeholder:"My New Chatflow",value:g,onChange:e=>x(e.target.value)})}),(0,p.jsxs)(l.c,{children:[(0,p.jsx)(d.c,{onClick:h,children:a.cancelButtonName}),(0,p.jsx)(u.y,{disabled:!y,variant:"contained",onClick:()=>m(g),children:a.confirmButtonName})]})]}):null;return(0,n.createPortal)(w,f)}},36572:(e,t,a)=>{a.d(t,{c:()=>b});var n=a(92572),o=a(81710),s=a(59192),r=a(83860),i=a(12464),c=a(95836),l=a(51515),d=a(78944),u=a(63556),p=a(54156),h=a(15860),m=a(69040),f=a(32160),g=a(54528),x=a(79557),y=a(78472),v=a(81424),w=a(39784),j=a(9e4);const b=e=>{let{show:t,dialogProps:a,onCancel:b,onConfirm:C}=e;const S=document.getElementById("portal"),k=(0,o.OY)();(0,v.c)();const D=function(){return k((0,r.mq)(...arguments))},T=function(){return k((0,r.EF)(...arguments))},[I,A]=(0,s.useState)([{prompt:""}]),[P,M]=(0,s.useState)({}),O=()=>{A([...I,{prompt:""}])};(0,s.useEffect)((()=>{if(a.chatflow&&a.chatflow.chatbotConfig)try{let e=JSON.parse(a.chatflow.chatbotConfig);if(M(e||{}),e.starterPrompts){let t=[];Object.getOwnPropertyNames(e.starterPrompts).forEach((a=>{e.starterPrompts[a]&&t.push(e.starterPrompts[a])})),A(t)}else A([{prompt:""}])}catch(e){A([{prompt:""}])}return()=>{}}),[a]),(0,s.useEffect)((()=>(k(t?{type:r.wp}:{type:r.OC}),()=>k({type:r.OC}))),[t,k]);const N=t?(0,j.jsxs)(c.c,{onClose:b,open:t,fullWidth:!0,maxWidth:"sm","aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[(0,j.jsx)(l.c,{sx:{fontSize:"1rem"},id:"alert-dialog-title",children:a.title||"Conversation Starter Prompts"}),(0,j.jsxs)(d.c,{children:[(0,j.jsx)("div",{style:{display:"flex",flexDirection:"column",borderRadius:10,background:"#d8f3dc",padding:10},children:(0,j.jsxs)("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:[(0,j.jsx)(x.CI$,{size:30,color:"#2d6a4f"}),(0,j.jsx)("span",{style:{color:"#2d6a4f",marginLeft:10,fontWeight:500},children:"Starter prompts will only be shown when there is no messages on the chat"})]})}),(0,j.jsx)(u.c,{sx:{"& > :not(style)":{m:1},pt:2},children:(0,j.jsx)(p.c,{children:I.map(((e,t)=>(0,j.jsxs)("div",{style:{display:"flex",width:"100%"},children:[(0,j.jsx)(u.c,{sx:{width:"95%",mb:1},children:(0,j.jsx)(h.c,{sx:{width:"100%"},type:"text",onChange:e=>((e,t)=>{const{name:a,value:n}=t.target,o=[...I];o[e][a]=n,A(o)})(t,e),size:"small",value:e.prompt,name:"prompt",endAdornment:(0,j.jsx)(m.c,{position:"end",sx:{padding:"2px"},children:I.length>1&&(0,j.jsx)(f.c,{sx:{height:30,width:30},size:"small",color:"error",disabled:1===I.length,onClick:()=>(e=>{const t=[...I];t.splice(e,1),A(t)})(t),edge:"end",children:(0,j.jsx)(x.MhX,{})})})},t)}),(0,j.jsx)(u.c,{sx:{width:"5%",mb:1},children:t===I.length-1&&(0,j.jsx)(f.c,{color:"primary",onClick:O,children:(0,j.jsx)(x.SU7,{})})})]},t)))})})]}),(0,j.jsxs)(g.c,{children:[(0,j.jsx)(i.c,{onClick:b,children:"Cancel"}),(0,j.jsx)(y.y,{variant:"contained",onClick:async()=>{try{let e={starterPrompts:{...I}};P.starterPrompts=e.starterPrompts;const t=await w.c.updateChatflow(a.chatflow.id,{chatbotConfig:JSON.stringify(P)});t.data&&(D({message:"Conversation Starter Prompts Saved",options:{key:(new Date).getTime()+Math.random(),variant:"success",action:e=>(0,j.jsx)(i.c,{style:{color:"white"},onClick:()=>T(e),children:(0,j.jsx)(x.KgB,{})})}}),k({type:r.kT,chatflow:t.data})),C()}catch(e){const t=e.response.data||"".concat(e.response.status,": ").concat(e.response.statusText);D({message:"Failed to save Conversation Starter Prompts: ".concat(t),options:{key:(new Date).getTime()+Math.random(),variant:"error",persist:!0,action:e=>(0,j.jsx)(i.c,{style:{color:"white"},onClick:()=>T(e),children:(0,j.jsx)(x.KgB,{})})}})}},children:"Save"})]})]}):null;return(0,n.createPortal)(N,S)}},67768:(e,t,a)=>{a.r(t),a.d(t,{default:()=>ia});var n=a(59192),o=a(94948),s=a(87724),r=a(58584),i=(a(46632),a(81710)),c=a(26696);function l(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];!function(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const{navigator:a}=(0,n.useContext)(c.yo);(0,n.useEffect)((()=>{if(!t)return;const n=a.block((t=>{const a={...t,retry(){n(),t.retry()}};e(a)}));return n}),[a,e,t])}((0,n.useCallback)((t=>{window.confirm(e)&&t.retry()}),[e]),t)}var d=a(83860),u=a(86155),p=a(12464),h=a(63556),m=a(59988),f=a(8936),g=a(2973),x=a(26e3),y=a(32160),v=a(2340),w=a(58424),j=a(7128),b=a(57651),C=a(83920),S=a(60560),k=a(25352),D=a(99664),T=a(92572),I=a(95836),A=a(51515),P=a(78944),M=a(69444),O=a(12392),N=a(8032),E=a(79756),R=a(22164),B=a(56264),q=a(46824),F=a(9e4);const L=e=>{let{columns:t,rows:a,sx:n}=e;return(0,F.jsx)(F.Fragment,{children:(0,F.jsx)(M.c,{component:O.c,children:(0,F.jsxs)(N.c,{sx:{minWidth:650,...n},"aria-label":"simple table",children:[(0,F.jsx)(E.c,{children:(0,F.jsx)(R.c,{children:t.map(((e,t)=>(0,F.jsx)(B.c,{children:e.charAt(0).toUpperCase()+e.slice(1)},t)))})}),(0,F.jsx)(q.c,{children:a.map(((e,t)=>(0,F.jsx)(R.c,{sx:{"&:last-child td, &:last-child th":{border:0}},children:Object.keys(e).map(((t,a)=>(0,F.jsx)(B.c,{children:e[t]},a)))},t)))})]})})})};var z=a(80576),H=a(31060);const U=e=>H.c.get("/flow-config/".concat(e)),J=e=>H.c.post("/node-config",e);var K=a(54136);const W=e=>{var t;let{show:a,dialogProps:o,onCancel:s}=e;const r=document.getElementById("portal"),c=(0,i.OY)(),l=(0,K.c)(J);(0,n.useEffect)((()=>{o.data&&l.request(o.data)}),[o]),(0,n.useEffect)((()=>(c(a?{type:d.wp}:{type:d.OC}),()=>c({type:d.OC}))),[a,c]);const u=a?(0,F.jsxs)(I.c,{onClose:s,open:a,fullWidth:!0,maxWidth:"md","aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[(0,F.jsx)(A.c,{sx:{fontSize:"1rem"},id:"alert-dialog-title",children:o.data&&o.data.name&&o.data.label&&(0,F.jsxs)("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:[(0,F.jsx)("div",{style:{width:50,height:50,marginRight:10,borderRadius:"50%",backgroundColor:"white"},children:(0,F.jsx)("img",{style:{width:"100%",height:"100%",padding:7,borderRadius:"50%",objectFit:"contain"},alt:o.data.name,src:"".concat(z.OM,"/api/v1/node-icon/").concat(o.data.name)})}),(0,F.jsxs)("div",{style:{display:"flex",flexDirection:"column",marginLeft:10},children:[o.data.label,(0,F.jsxs)("div",{style:{display:"flex",flexDirection:"row"},children:[(0,F.jsx)("div",{style:{display:"flex",flexDirection:"row",width:"max-content",borderRadius:15,background:"rgb(254,252,191)",padding:5,paddingLeft:10,paddingRight:10,marginTop:5,marginBottom:5},children:(0,F.jsx)("span",{style:{color:"rgb(116,66,16)",fontSize:"0.825rem"},children:o.data.id})}),o.data.version&&(0,F.jsx)("div",{style:{display:"flex",flexDirection:"row",width:"max-content",borderRadius:15,background:"#e9edc9",padding:5,paddingLeft:10,paddingRight:10,marginTop:5,marginLeft:10,marginBottom:5},children:(0,F.jsxs)("span",{style:{color:"#606c38",fontSize:"0.825rem"},children:["version ",o.data.version]})}),o.data.badge&&(0,F.jsx)("div",{style:{display:"flex",flexDirection:"row",width:"max-content",borderRadius:15,background:"DEPRECATING"===o.data.badge?"#ffe57f":"#52b69a",padding:5,paddingLeft:10,paddingRight:10,marginTop:5,marginLeft:10,marginBottom:5},children:(0,F.jsx)("span",{style:{color:"DEPRECATING"!==o.data.badge?"white":"inherit",fontSize:"0.825rem"},children:o.data.badge})})]})]})]})}),(0,F.jsxs)(P.c,{children:[(null===(t=o.data)||void 0===t?void 0:t.description)&&(0,F.jsx)("div",{style:{padding:10,marginBottom:10},children:(0,F.jsx)("span",{children:o.data.description})}),l.data&&l.data.length>0&&(0,F.jsx)(L,{rows:l.data.map((e=>{const{node:t,nodeId:a,...n}=e;return n})),columns:Object.keys(l.data[0]).slice(-3)})]})]}):null;return(0,T.createPortal)(u,r)};var Y=a(79557),_=a(3868);const G=(0,x.cp)(C.c)((e=>{let{theme:t}=e;return{background:t.palette.card.main,color:t.darkTextPrimary,border:"solid 1px",borderColor:t.palette.primary[200]+75,width:"300px",height:"auto",padding:"10px",boxShadow:"0 2px 14px 0 rgb(32 40 45 / 8%)","&:hover":{borderColor:t.palette.primary.main}}})),X=(0,x.cp)((e=>{let{className:t,...a}=e;return(0,F.jsx)(j.c,{...a,classes:{popper:t}})}))((e=>{let{theme:t}=e;return{["& .".concat(b.c.tooltip)]:{backgroundColor:t.palette.nodeToolTip.background,color:t.palette.nodeToolTip.color,boxShadow:t.shadows[1]}}})),V=e=>{var t,a,o,s,r,c;let{data:l}=e;const d=(0,g.c)(),u=(0,i.w1)((e=>e.canvas)),{deleteNode:m,duplicateNode:f}=(0,n.useContext)(_.y),[x,b]=(0,n.useState)(!1),[C,T]=(0,n.useState)({}),[I,A]=(0,n.useState)(!1),[P,M]=(0,n.useState)({}),[O,N]=(0,n.useState)(""),[E,R]=(0,n.useState)(!1);return(0,n.useEffect)((()=>{const e=u.componentNodes.find((e=>e.name===l.name));var t;e&&(l.version?l.version&&e.version>l.version?N(((e,t)=>"Node version ".concat(e," outdated\nUpdate to latest version ").concat(t))(l.version,e.version)):"DEPRECATING"===e.badge&&N("This node will be deprecated in the next release. Change to a new node tagged with NEW"):N((t=e.version,"Node outdated\nUpdate to latest version ".concat(t))))}),[u.componentNodes,l.name,l.version]),(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)(G,{content:!1,sx:{padding:0,borderColor:l.selected?d.palette.primary.main:d.palette.text.secondary},border:!1,children:(0,F.jsx)(X,{open:!u.canvasDialogShow&&E,onClose:()=>{R(!1)},onOpen:()=>{R(!0)},disableFocusListener:!0,title:(0,F.jsxs)("div",{style:{background:"transparent",display:"flex",flexDirection:"column"},children:[(0,F.jsx)(y.c,{title:"Duplicate",onClick:()=>{f(l.id)},sx:{height:"35px",width:"35px","&:hover":{color:null===d||void 0===d?void 0:d.palette.primary.main}},color:null!==d&&void 0!==d&&null!==(t=d.customization)&&void 0!==t&&t.isDarkMode?null===(a=d.colors)||void 0===a?void 0:a.paper:"inherit",children:(0,F.jsx)(Y.Ql2,{})}),(0,F.jsx)(y.c,{title:"Delete",onClick:()=>{m(l.id)},sx:{height:"35px",width:"35px","&:hover":{color:"red"}},color:null!==d&&void 0!==d&&null!==(o=d.customization)&&void 0!==o&&o.isDarkMode?null===(s=d.colors)||void 0===s?void 0:s.paper:"inherit",children:(0,F.jsx)(Y.MhX,{})}),(0,F.jsx)(y.c,{title:"Info",onClick:()=>{M({data:l}),A(!0)},sx:{height:"35px",width:"35px","&:hover":{color:null===d||void 0===d?void 0:d.palette.secondary.main}},color:null!==d&&void 0!==d&&null!==(r=d.customization)&&void 0!==r&&r.isDarkMode?null===(c=d.colors)||void 0===c?void 0:c.paper:"inherit",children:(0,F.jsx)(Y.ANs,{})})]}),placement:"right-start",children:(0,F.jsxs)(h.c,{children:[(0,F.jsxs)("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:[(0,F.jsx)(h.c,{style:{width:50,marginRight:10,padding:5},children:(0,F.jsx)("div",{style:{...d.typography.commonAvatar,...d.typography.largeAvatar,borderRadius:"50%",backgroundColor:"white",cursor:"grab"},children:(0,F.jsx)("img",{style:{width:"100%",height:"100%",padding:5,objectFit:"contain"},src:"".concat(z.OM,"/api/v1/node-icon/").concat(l.name),alt:"Notification"})})}),(0,F.jsx)(h.c,{children:(0,F.jsx)(v.c,{sx:{fontSize:"1rem",fontWeight:500,mr:2},children:l.label})}),O&&(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)("div",{style:{flexGrow:1}}),(0,F.jsx)(j.c,{title:(0,F.jsx)("span",{style:{whiteSpace:"pre-line"},children:O}),placement:"top",children:(0,F.jsx)(y.c,{sx:{height:35,width:35},children:(0,F.jsx)(Y.IRp,{size:35,color:"orange"})})})]})]}),(l.inputAnchors.length>0||l.inputParams.length>0)&&(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)(w.c,{}),(0,F.jsx)(h.c,{sx:{background:d.palette.asyncSelect.main,p:1},children:(0,F.jsx)(v.c,{sx:{fontWeight:500,textAlign:"center"},children:"Inputs"})}),(0,F.jsx)(w.c,{})]}),l.inputAnchors.map(((e,t)=>(0,F.jsx)(S.c,{inputAnchor:e,data:l},t))),l.inputParams.filter((e=>!e.hidden)).map(((e,t)=>(0,F.jsx)(S.c,{inputParam:e,data:l},t))),l.inputParams.find((e=>e.additionalParams))&&(0,F.jsx)("div",{style:{textAlign:"center",marginTop:l.inputParams.filter((e=>e.additionalParams)).length===l.inputParams.length+l.inputAnchors.length?20:0},children:(0,F.jsx)(p.c,{sx:{borderRadius:25,width:"90%",mb:2},variant:"outlined",onClick:()=>{const e={data:l,inputParams:l.inputParams.filter((e=>e.additionalParams)),confirmButtonName:"Save",cancelButtonName:"Cancel"};T(e),b(!0)},children:"Additional Parameters"})}),(0,F.jsx)(w.c,{}),(0,F.jsx)(h.c,{sx:{background:d.palette.asyncSelect.main,p:1},children:(0,F.jsx)(v.c,{sx:{fontWeight:500,textAlign:"center"},children:"Output"})}),(0,F.jsx)(w.c,{}),l.outputAnchors.map(((e,t)=>(0,F.jsx)(k.c,{outputAnchor:e,data:l},t)))]})})}),(0,F.jsx)(D.c,{show:x,dialogProps:C,onCancel:()=>b(!1)}),(0,F.jsx)(W,{show:I,dialogProps:P,onCancel:()=>A(!1)})]})};a(12424);const Q=e=>{let{id:t,sourceX:a,sourceY:s,targetX:r,targetY:c,sourcePosition:l,targetPosition:u,style:p={},data:h,markerEnd:m}=e;const[f,g,x]=(0,o.C_)({sourceX:a,sourceY:s,sourcePosition:l,targetX:r,targetY:c,targetPosition:u}),{deleteEdge:y}=(0,n.useContext)(_.y),v=(0,i.OY)();return(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)("path",{id:t,style:p,className:"react-flow__edge-path",d:f,markerEnd:m}),h&&h.label&&(0,F.jsx)(o.OM,{x:a+10,y:s+10,label:h.label,labelStyle:{fill:"black"},labelBgStyle:{fill:"transparent"},labelBgPadding:[2,4],labelBgBorderRadius:2}),(0,F.jsx)("foreignObject",{width:40,height:40,x:g-20,y:x-20,className:"edgebutton-foreignobject",requiredExtensions:"http://www.w3.org/1999/xhtml",children:(0,F.jsx)("div",{children:(0,F.jsx)("button",{className:"edgebutton",onClick:e=>((e,t)=>{e.stopPropagation(),y(t),v({type:d.LA})})(e,t),children:"\xd7"})})})]})};var Z=a(66448),$=a(16024),ee=a(20332),te=a(59756),ae=a(78508),ne=a(4268),oe=a(54156),se=a(94604),re=a.n(se),ie=a(91776),ce=a(90464);const le={IconTrash:Y.MhX,IconFileUpload:Y.szB,IconFileExport:Y.y_w,IconCopy:Y.Ql2,IconSearch:Y.OwM,IconMessage:Y.u4t,IconPictureInPictureOff:Y.g72},de={id:"settings",title:"",type:"group",children:[{id:"conversationStarters",title:"Starter Prompts",type:"item",url:"",icon:le.IconPictureInPictureOff},{id:"viewMessages",title:"View Messages",type:"item",url:"",icon:le.IconMessage},{id:"duplicateChatflow",title:"Duplicate Chatflow",type:"item",url:"",icon:le.IconCopy},{id:"loadChatflow",title:"Load Chatflow",type:"item",url:"",icon:le.IconFileUpload},{id:"exportChatflow",title:"Export Chatflow",type:"item",url:"",icon:le.IconFileExport},{id:"analyseChatflow",title:"Analyse Chatflow",type:"item",url:"",icon:le.IconSearch},{id:"deleteChatflow",title:"Delete Chatflow",type:"item",url:"",icon:le.IconTrash}]},ue=e=>{let{chatflow:t,isSettingsOpen:a,anchorEl:o,onSettingsItemClick:s,onUploadFile:r,onClose:i}=e;const c=(0,g.c)(),[l,d]=(0,n.useState)([]),[u,p]=(0,n.useState)(!1);(0,n.useEffect)((()=>{if(t&&!t.id){const e=de.children.filter((e=>"loadChatflow"===e.id));d(e)}else if(t&&t.id){const e=de.children;d(e)}}),[t]),(0,n.useEffect)((()=>{p(a)}),[a]);const m=l.map((e=>(0,F.jsx)(ce.c,{item:e,level:1,navType:"SETTINGS",onClick:e=>s(e),onUploadFile:r},e.id)));return(0,F.jsx)(F.Fragment,{children:(0,F.jsx)(ae.c,{placement:"bottom-end",open:u,anchorEl:o,role:void 0,transition:!0,disablePortal:!0,popperOptions:{modifiers:[{name:"offset",options:{offset:[170,20]}}]},sx:{zIndex:1e3},children:e=>{let{TransitionProps:t}=e;return(0,F.jsx)(ie.c,{in:u,...t,children:(0,F.jsx)(O.c,{children:(0,F.jsx)(ne.q,{onClickAway:i,children:(0,F.jsx)(C.c,{border:!1,elevation:16,content:!1,boxShadow:!0,shadow:c.shadows[16],children:(0,F.jsx)(re(),{style:{height:"100%",maxHeight:"calc(100vh - 250px)",overflowX:"hidden"},children:(0,F.jsx)(h.c,{sx:{p:2},children:(0,F.jsx)(oe.c,{children:m})})})})})})})}})})};var pe=a(80760),he=a(38608),me=a(40584),fe=a(93072),ge=a(49248),xe=a(91712),ye=a(77996),ve=a(74220),we=a(18184),je=a(67064),be=a(75184),Ce=a(15860),Se=a(31824),ke=a(78472),De=a(60708),Te=a(39784),Ie=a(81424);const Ae="#ffffff",Pe=16,Me="#303235",Oe={backgroundColor:"#f7f8ff",textColor:"#303235"},Ne={backgroundColor:"#3B81F6",textColor:"#ffffff"},Ee={backgroundColor:"#ffffff",textColor:"#303235",sendButtonColor:"#3B81F6"},Re=e=>{var t,a,o,s,r,c,l,u,m,f,x,w,j,b,C,S,k,D,T,I,A,P,M,O,N,E,R,B,q,L,H,U;let{isSessionMemory:J}=e;const K=(0,i.OY)(),W=(0,g.c)(),_=(0,i.w1)((e=>e.canvas.chatflow)),G=_.id,X=_.chatbotConfig?JSON.parse(_.chatbotConfig):{};(0,Ie.c)();const V=function(){return K((0,d.mq)(...arguments))},Q=function(){return K((0,d.EF)(...arguments))},[Z,$]=(0,n.useState)(null!==(t=_.isPublic)&&void 0!==t&&t),[te,ae]=(0,n.useState)(null!==(a=null===X||void 0===X?void 0:X.generateNewSession)&&void 0!==a&&a),[ne,oe]=(0,n.useState)(null!==(o=null===X||void 0===X?void 0:X.title)&&void 0!==o?o:""),[se,re]=(0,n.useState)(null!==(s=null===X||void 0===X?void 0:X.titleAvatarSrc)&&void 0!==s?s:""),[ie,ce]=(0,n.useState)(null!==(r=null===X||void 0===X?void 0:X.welcomeMessage)&&void 0!==r?r:""),[le,de]=(0,n.useState)(null!==(c=null===X||void 0===X?void 0:X.backgroundColor)&&void 0!==c?c:Ae),[ue,pe]=(0,n.useState)(null!==(l=null===X||void 0===X?void 0:X.fontSize)&&void 0!==l?l:Pe),[he,me]=(0,n.useState)(null!==(u=null===X||void 0===X?void 0:X.poweredByTextColor)&&void 0!==u?u:Me),[fe,ge]=(0,n.useState)(null!==(m=null===X||void 0===X||null===(f=X.botMessage)||void 0===f?void 0:f.backgroundColor)&&void 0!==m?m:Oe.backgroundColor),[xe,ye]=(0,n.useState)(null!==(x=null===X||void 0===X||null===(w=X.botMessage)||void 0===w?void 0:w.textColor)&&void 0!==x?x:Oe.textColor),[ve,we]=(0,n.useState)(null!==(j=null===X||void 0===X||null===(b=X.botMessage)||void 0===b?void 0:b.avatarSrc)&&void 0!==j?j:""),[Re,Be]=(0,n.useState)(null!==(C=null===X||void 0===X||null===(S=X.botMessage)||void 0===S?void 0:S.showAvatar)&&void 0!==C&&C),[qe,Fe]=(0,n.useState)(null!==(k=null===X||void 0===X||null===(D=X.userMessage)||void 0===D?void 0:D.backgroundColor)&&void 0!==k?k:Ne.backgroundColor),[Le,ze]=(0,n.useState)(null!==(T=null===X||void 0===X||null===(I=X.userMessage)||void 0===I?void 0:I.textColor)&&void 0!==T?T:Ne.textColor),[He,Ue]=(0,n.useState)(null!==(A=null===X||void 0===X||null===(P=X.userMessage)||void 0===P?void 0:P.avatarSrc)&&void 0!==A?A:""),[Je,Ke]=(0,n.useState)(null!==(M=null===X||void 0===X||null===(O=X.userMessage)||void 0===O?void 0:O.showAvatar)&&void 0!==M&&M),[We,Ye]=(0,n.useState)(null!==(N=null===X||void 0===X||null===(E=X.textInput)||void 0===E?void 0:E.backgroundColor)&&void 0!==N?N:Ee.backgroundColor),[_e,Ge]=(0,n.useState)(null!==(R=null===X||void 0===X||null===(B=X.textInput)||void 0===B?void 0:B.textColor)&&void 0!==R?R:Ee.textColor),[Xe,Ve]=(0,n.useState)(null!==(q=null===X||void 0===X||null===(L=X.textInput)||void 0===L?void 0:L.placeholder)&&void 0!==q?q:""),[Qe,Ze]=(0,n.useState)(null!==(H=null===X||void 0===X||null===(U=X.textInput)||void 0===U?void 0:U.sendButtonColor)&&void 0!==H?H:Ee.sendButtonColor),[$e,et]=(0,n.useState)(null),[tt,at]=(0,n.useState)(""),[nt,ot]=(0,n.useState)(""),st=Boolean($e),[rt,it]=(0,n.useState)(null),ct=Boolean(rt),lt=()=>{const e={botMessage:{showAvatar:!1},userMessage:{showAvatar:!1},textInput:{},overrideConfig:{}};return ne&&(e.title=ne),se&&(e.titleAvatarSrc=se),ie&&(e.welcomeMessage=ie),le&&(e.backgroundColor=le),ue&&(e.fontSize=ue),he&&(e.poweredByTextColor=he),fe&&(e.botMessage.backgroundColor=fe),xe&&(e.botMessage.textColor=xe),ve&&(e.botMessage.avatarSrc=ve),Re&&(e.botMessage.showAvatar=Re),qe&&(e.userMessage.backgroundColor=qe),Le&&(e.userMessage.textColor=Le),He&&(e.userMessage.avatarSrc=He),Je&&(e.userMessage.showAvatar=Je),We&&(e.textInput.backgroundColor=We),_e&&(e.textInput.textColor=_e),Xe&&(e.textInput.placeholder=Xe),Qe&&(e.textInput.sendButtonColor=Qe),J&&(e.overrideConfig.generateNewSession=te),null!==X&&void 0!==X&&X.starterPrompts&&(e.starterPrompts=X.starterPrompts),e},dt=()=>{it(null)},ut=(e,t,a)=>(0,F.jsx)(h.c,{sx:{pt:2,pb:2},children:(0,F.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start"},children:[(0,F.jsx)(v.c,{sx:{mb:1},children:a}),(0,F.jsx)(h.c,{sx:{cursor:"pointer",width:"30px",height:"30px",border:"1px solid #616161",marginRight:"10px",backgroundColor:null!==e&&void 0!==e?e:"#ffffff",borderRadius:"5px"},onClick:a=>{at(t),ot(null!==e&&void 0!==e?e:"#ffffff"),et(a.currentTarget)}})]})}),pt=(e,t,a)=>(0,F.jsx)(h.c,{sx:{pt:2,pb:2},children:(0,F.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start"},children:[(0,F.jsx)(v.c,{sx:{mb:1},children:a}),(0,F.jsx)(be.c,{id:t,checked:e,onChange:e=>{((e,t)=>{switch(t){case"botMessageShowAvatar":Be(e);break;case"userMessageShowAvatar":Ke(e);break;case"generateNewSession":ae(e)}})(e.target.checked,t)}})]})}),ht=function(e,t,a){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"string",o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return(0,F.jsx)(h.c,{sx:{pt:2,pb:2},children:(0,F.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start"},children:[(0,F.jsx)(v.c,{sx:{mb:1},children:a}),(0,F.jsx)(Ce.c,{id:t,type:n,fullWidth:!0,value:e,placeholder:o,name:t,onChange:e=>{((e,t)=>{switch(t){case"title":oe(e);break;case"titleAvatarSrc":re(e);break;case"welcomeMessage":ce(e);break;case"fontSize":pe(e);break;case"botMessageAvatarSrc":we(e);break;case"userMessageAvatarSrc":Ue(e);break;case"textInputPlaceholder":Ve(e)}})(e.target.value,t)}})]})})};return(0,F.jsxs)(F.Fragment,{children:[(0,F.jsxs)(ee.c,{direction:"row",children:[(0,F.jsx)(v.c,{sx:{p:1,borderRadius:10,backgroundColor:W.palette.primary.light,width:"max-content",height:"max-content"},variant:"h5",children:"".concat(z.OM,"/chatbot/").concat(G)}),(0,F.jsx)(y.c,{title:"Copy Link",color:"success",onClick:e=>{navigator.clipboard.writeText("".concat(z.OM,"/chatbot/").concat(G)),it(e.currentTarget),setTimeout((()=>{dt()}),1500)},children:(0,F.jsx)(Y.Ql2,{})}),(0,F.jsx)(y.c,{title:"Open New Tab",color:"primary",onClick:()=>window.open("".concat(z.OM,"/chatbot/").concat(G),"_blank"),children:(0,F.jsx)(Y.ptz,{})}),(0,F.jsx)("div",{style:{flex:1}}),(0,F.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,F.jsx)(be.c,{checked:Z,onChange:e=>{$(e.target.checked),(async e=>{try{const t=await Te.c.updateChatflow(G,{isPublic:e});t.data&&(V({message:"Chatbot Configuration Saved",options:{key:(new Date).getTime()+Math.random(),variant:"success",action:e=>(0,F.jsx)(p.c,{style:{color:"white"},onClick:()=>Q(e),children:(0,F.jsx)(Y.KgB,{})})}}),K({type:d.kT,chatflow:t.data}))}catch(t){console.error(t);const e=t.response.data||"".concat(t.response.status,": ").concat(t.response.statusText);V({message:"Failed to save Chatbot Configuration: ".concat(e),options:{key:(new Date).getTime()+Math.random(),variant:"error",persist:!0,action:e=>(0,F.jsx)(p.c,{style:{color:"white"},onClick:()=>Q(e),children:(0,F.jsx)(Y.KgB,{})})}})}})(e.target.checked)}}),(0,F.jsx)(v.c,{children:"Make Public"}),(0,F.jsx)(De.c,{style:{marginLeft:10},title:"Making public will allow anyone to access the chatbot without username & password"})]})]}),ht(ne,"title","Title","string","Flowise Assistant"),ht(se,"titleAvatarSrc","Title Avatar Link","string","https://raw.githubusercontent.com/FlowiseAI/Flowise/main/assets/FloWiseAI_dark.png"),ht(ie,"welcomeMessage","Welcome Message","string","Hello! This is custom welcome message"),ut(le,"backgroundColor","Background Color"),ht(ue,"fontSize","Font Size","number"),ut(he,"poweredByTextColor","PoweredBy TextColor"),(0,F.jsx)(v.c,{variant:"h4",sx:{mb:1,mt:2},children:"Bot Message"}),ut(fe,"botMessageBackgroundColor","Background Color"),ut(xe,"botMessageTextColor","Text Color"),ht(ve,"botMessageAvatarSrc","Avatar Link","string","https://raw.githubusercontent.com/zahidkhawaja/langchain-chat-nextjs/main/public/parroticon.png"),pt(Re,"botMessageShowAvatar","Show Avatar"),(0,F.jsx)(v.c,{variant:"h4",sx:{mb:1,mt:2},children:"User Message"}),ut(qe,"userMessageBackgroundColor","Background Color"),ut(Le,"userMessageTextColor","Text Color"),ht(He,"userMessageAvatarSrc","Avatar Link","string","https://raw.githubusercontent.com/zahidkhawaja/langchain-chat-nextjs/main/public/usericon.png"),pt(Je,"userMessageShowAvatar","Show Avatar"),(0,F.jsx)(v.c,{variant:"h4",sx:{mb:1,mt:2},children:"Text Input"}),ut(We,"textInputBackgroundColor","Background Color"),ut(_e,"textInputTextColor","Text Color"),ht(Xe,"textInputPlaceholder","TextInput Placeholder","string","Type question.."),ut(Qe,"textInputSendButtonColor","TextIntput Send Button Color"),J&&(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)(v.c,{variant:"h4",sx:{mb:1,mt:2},children:"Session Memory"}),pt(te,"generateNewSession","Start new session when chatbot link is opened or refreshed")]}),(0,F.jsx)(ke.y,{style:{marginBottom:10,marginTop:10},variant:"contained",onClick:()=>(async()=>{try{const e=await Te.c.updateChatflow(G,{chatbotConfig:JSON.stringify(lt())});e.data&&(V({message:"Chatbot Configuration Saved",options:{key:(new Date).getTime()+Math.random(),variant:"success",action:e=>(0,F.jsx)(p.c,{style:{color:"white"},onClick:()=>Q(e),children:(0,F.jsx)(Y.KgB,{})})}}),K({type:d.kT,chatflow:e.data}))}catch(e){console.error(e);const t=e.response.data||"".concat(e.response.status,": ").concat(e.response.statusText);V({message:"Failed to save Chatbot Configuration: ".concat(t),options:{key:(new Date).getTime()+Math.random(),variant:"error",persist:!0,action:e=>(0,F.jsx)(p.c,{style:{color:"white"},onClick:()=>Q(e),children:(0,F.jsx)(Y.KgB,{})})}})}})(),children:"Save Changes"}),(0,F.jsx)(Se.cp,{open:st,anchorEl:$e,onClose:()=>{et(null)},anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"left"},children:(0,F.jsx)(je.aS,{color:nt,onChange:e=>(e=>{switch(tt){case"backgroundColor":de(e);break;case"poweredByTextColor":me(e);break;case"botMessageBackgroundColor":ge(e);break;case"botMessageTextColor":ye(e);break;case"userMessageBackgroundColor":Fe(e);break;case"userMessageTextColor":ze(e);break;case"textInputBackgroundColor":Ye(e);break;case"textInputTextColor":Ge(e);break;case"textInputSendButtonColor":Ze(e)}ot(e)})(e.hex)})}),(0,F.jsx)(Se.cp,{open:ct,anchorEl:rt,onClose:dt,anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"left"},children:(0,F.jsx)(v.c,{variant:"h6",sx:{pl:1,pr:1,color:"white",background:W.palette.success.dark},children:"Copied!"})})]})};var Be=a(8596),qe=a(4366);const Fe=e=>{let{value:t,label:a,onChange:o,disabled:s=!1}=e;const[r,i]=(0,n.useState)(t);return(0,F.jsx)(F.Fragment,{children:(0,F.jsx)(Be.c,{sx:{mt:1,width:"100%"},size:"small",control:(0,F.jsx)(qe.c,{disabled:s,checked:r,onChange:e=>{i(e.target.checked),o(e.target.checked)}}),label:a})})};function Le(e){const{children:t,value:a,index:n,...o}=e;return(0,F.jsx)("div",{role:"tabpanel",hidden:a!==n,id:"attachment-tabpanel-".concat(n),"aria-labelledby":"attachment-tab-".concat(n),...o,children:a===n&&(0,F.jsx)(h.c,{sx:{p:1},children:t})})}function ze(e){return{id:"attachment-tab-".concat(e),"aria-controls":"attachment-tabpanel-".concat(e)}}const He=function(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?'button: {\n                    backgroundColor: "#3B81F6",\n                    right: 20,\n                    bottom: 20,\n                    size: "medium",\n                    iconColor: "white",\n                    customIconSrc: "https://raw.githubusercontent.com/walkxcode/dashboard-icons/main/svg/google-messages.svg",\n                }':'button: {\n                backgroundColor: "#3B81F6",\n                right: 20,\n                bottom: 20,\n                size: "medium",\n                iconColor: "white",\n                customIconSrc: "https://raw.githubusercontent.com/walkxcode/dashboard-icons/main/svg/google-messages.svg",\n            }'},Ue=function(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?'chatWindow: {\n                    welcomeMessage: "Hello! This is custom welcome message",\n                    backgroundColor: "#ffffff",\n                    height: 700,\n                    width: 400,\n                    fontSize: 16,\n                    poweredByTextColor: "#303235",\n                    botMessage: {\n                        backgroundColor: "#f7f8ff",\n                        textColor: "#303235",\n                        showAvatar: true,\n                        avatarSrc: "https://raw.githubusercontent.com/zahidkhawaja/langchain-chat-nextjs/main/public/parroticon.png",\n                    },\n                    userMessage: {\n                        backgroundColor: "#3B81F6",\n                        textColor: "#ffffff",\n                        showAvatar: true,\n                        avatarSrc: "https://raw.githubusercontent.com/zahidkhawaja/langchain-chat-nextjs/main/public/usericon.png",\n                    },\n                    textInput: {\n                        placeholder: "Type your question",\n                        backgroundColor: "#ffffff",\n                        textColor: "#303235",\n                        sendButtonColor: "#3B81F6",\n                    }\n                }':'chatWindow: {\n                welcomeMessage: "Hello! This is custom welcome message",\n                backgroundColor: "#ffffff",\n                height: 700,\n                width: 400,\n                fontSize: 16,\n                poweredByTextColor: "#303235",\n                botMessage: {\n                    backgroundColor: "#f7f8ff",\n                    textColor: "#303235",\n                    showAvatar: true,\n                    avatarSrc: "https://raw.githubusercontent.com/zahidkhawaja/langchain-chat-nextjs/main/public/parroticon.png",\n                },\n                userMessage: {\n                    backgroundColor: "#3B81F6",\n                    textColor: "#ffffff",\n                    showAvatar: true,\n                    avatarSrc: "https://raw.githubusercontent.com/zahidkhawaja/langchain-chat-nextjs/main/public/usericon.png",\n                },\n                textInput: {\n                    placeholder: "Type your question",\n                    backgroundColor: "#ffffff",\n                    textColor: "#303235",\n                    sendButtonColor: "#3B81F6",\n                }\n            }'},Je=e=>{let{chatflowid:t}=e;const a=["Popup Html","Fullpage Html","Popup React","Fullpage React"],[o,s]=(0,n.useState)(0),[r,i]=(0,n.useState)(!1),c=e=>{i(e)},l=e=>{switch(e){case"Popup Html":return(e=>'<script type="module">\n    import Chatbot from "https://cdn.jsdelivr.net/npm/flowise-embed/dist/web.js"\n    Chatbot.init({\n        chatflowid: "'.concat(e,'",\n        apiHost: "').concat(z.OM,'",\n    })\n<\/script>'))(t);case"Fullpage Html":return(e=>'<flowise-fullchatbot></flowise-fullchatbot>\n<script type="module">\n    import Chatbot from "https://cdn.jsdelivr.net/npm/flowise-embed/dist/web.js"\n    Chatbot.initFull({\n        chatflowid: "'.concat(e,'",\n        apiHost: "').concat(z.OM,'",\n    })\n<\/script>'))(t);case"Popup React":return(e=>"import { BubbleChat } from 'flowise-embed-react'\n\nconst App = () => {\n    return (\n        <BubbleChat chatflowid=\"".concat(e,'" apiHost="').concat(z.OM,'" />\n    );\n};'))(t);case"Fullpage React":return(e=>'import { FullPageChat } from "flowise-embed-react"\n\nconst App = () => {\n    return (\n        <FullPageChat\n            chatflowid="'.concat(e,'"\n            apiHost="').concat(z.OM,'"\n        />\n    );\n};'))(t);default:return""}},d=e=>{switch(e){case"Popup Html":return(e=>'<script type="module">\n    import Chatbot from "https://cdn.jsdelivr.net/npm/flowise-embed/dist/web.js"\n    Chatbot.init({\n        chatflowid: "'.concat(e,'",\n        apiHost: "').concat(z.OM,'",\n        chatflowConfig: {\n            // topK: 2\n        },\n        theme: {\n            ').concat(He(),",\n            ").concat(Ue(),"\n        }\n    })\n<\/script>"))(t);case"Fullpage Html":return(e=>'<flowise-fullchatbot></flowise-fullchatbot>\n<script type="module">\n    import Chatbot from "https://cdn.jsdelivr.net/npm/flowise-embed/dist/web.js"\n    Chatbot.initFull({\n        chatflowid: "'.concat(e,'",\n        apiHost: "').concat(z.OM,'",\n        theme: {\n            ').concat(Ue(),"\n        }\n    })\n<\/script>"))(t);case"Popup React":return(e=>"import { BubbleChat } from 'flowise-embed-react'\n\nconst App = () => {\n    return (\n        <BubbleChat\n            chatflowid=\"".concat(e,'"\n            apiHost="').concat(z.OM,'"\n            theme={{\n                ').concat(He(!0),",\n                ").concat(Ue(!0),"\n            }}\n        />\n    );\n};"))(t);case"Fullpage React":return(e=>'import { FullPageChat } from "flowise-embed-react"\n\nconst App = () => {\n    return (\n        <FullPageChat\n            chatflowid="'.concat(e,'"\n            apiHost="').concat(z.OM,'"\n            theme={{\n                ').concat(Ue(!0),"\n            }}\n        />\n    );\n};"))(t);default:return""}};return(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:(0,F.jsx)("div",{style:{flex:80},children:(0,F.jsx)(he.c,{value:o,onChange:(e,t)=>{s(t)},"aria-label":"tabs",children:a.map(((e,t)=>(0,F.jsx)(me.c,{label:e,...ze(t)},t)))})})}),(0,F.jsx)("div",{style:{marginTop:10}}),a.map(((e,t)=>(0,F.jsxs)(Le,{value:o,index:t,children:[(0===o||1===o)&&(0,F.jsxs)(F.Fragment,{children:[(0,F.jsxs)("span",{children:["Paste this anywhere in the ",(0,F.jsx)("code",{children:"<body>"})," tag of your html file.",(0,F.jsxs)("p",{children:["You can also specify a\xa0",(0,F.jsx)("a",{rel:"noreferrer",target:"_blank",href:"https://www.npmjs.com/package/flowise-embed?activeTab=versions",children:"version"}),":\xa0",(0,F.jsx)("code",{children:"https://cdn.jsdelivr.net/npm/flowise-embed@<version>/dist/web.js"})]})]}),(0,F.jsx)("div",{style:{height:10}})]}),(0,F.jsx)(ye.UD,{theme:ye.ig,text:l(e),language:"javascript",showLineNumbers:!1,wrapLines:!0}),(0,F.jsx)(Fe,{label:"Show Embed Chat Config",value:r,onChange:c}),r&&(0,F.jsx)(ye.UD,{theme:ye.ig,text:d(e),language:"javascript",showLineNumbers:!1,wrapLines:!0})]},t)))]})},Ke=()=>{var e,t,a,o,s,r;const c=(0,i.OY)(),l=(0,i.w1)((e=>e.canvas.chatflow)),u=l.id,m=l.apiConfig?JSON.parse(l.apiConfig):{};(0,Ie.c)();const f=function(){return c((0,d.mq)(...arguments))},g=function(){return c((0,d.EF)(...arguments))},[x,y]=(0,n.useState)(null!==(e=null===m||void 0===m||null===(t=m.rateLimit)||void 0===t?void 0:t.limitMax)&&void 0!==e?e:""),[w,j]=(0,n.useState)(null!==(a=null===m||void 0===m||null===(o=m.rateLimit)||void 0===o?void 0:o.limitDuration)&&void 0!==a?a:""),[b,C]=(0,n.useState)(null!==(s=null===m||void 0===m||null===(r=m.rateLimit)||void 0===r?void 0:r.limitMsg)&&void 0!==s?s:""),S=()=>{const e={rateLimit:{}},t=[!x,!w,!b].filter((e=>!1===e));if(t.length>=1&&t.length<=2)throw new Error("Need to fill all rate limit input fields");return 3===t.length&&(e.rateLimit={limitMax:x,limitDuration:w,limitMsg:b}),e},k=function(e,t,a){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"string",o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return(0,F.jsx)(h.c,{sx:{pt:2,pb:2},children:(0,F.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start"},children:[(0,F.jsx)(v.c,{sx:{mb:1},children:a}),(0,F.jsx)(Ce.c,{id:t,type:n,fullWidth:!0,value:e,placeholder:o,name:t,onChange:e=>{((e,t)=>{switch(t){case"limitMax":y(e);break;case"limitDuration":j(e);break;case"limitMsg":C(e)}})(e.target.value,t)}})]})})};return(0,F.jsxs)(F.Fragment,{children:[(0,F.jsxs)(v.c,{variant:"h4",sx:{mb:1,mt:2},children:["Rate Limit"," ",(0,F.jsx)(De.c,{style:{mb:1,mt:2,marginLeft:10},title:'Visit <a target="_blank" href="https://docs.flowiseai.com/rate-limit">Rate Limit Setup Guide</a> to set up Rate Limit correctly in your hosting environment.'})]}),k(x,"limitMax","Message Limit per Duration","number"),k(w,"limitDuration","Duration in Second","number"),k(b,"limitMsg","Limit Message","string"),(0,F.jsx)(ke.y,{style:{marginBottom:10,marginTop:10},variant:"contained",onClick:()=>(async()=>{try{const e=await Te.c.updateChatflow(u,{apiConfig:JSON.stringify(S())});e.data&&(f({message:"API Configuration Saved",options:{key:(new Date).getTime()+Math.random(),variant:"success",action:e=>(0,F.jsx)(p.c,{style:{color:"white"},onClick:()=>g(e),children:(0,F.jsx)(Y.KgB,{})})}}),c({type:d.kT,chatflow:e.data}))}catch(e){console.error(e);const t=e.response?e.response.data||"".concat(e.response.status,": ").concat(e.response.statusText):e.message;f({message:"Failed to save API Configuration: ".concat(t),options:{key:(new Date).getTime()+Math.random(),variant:"error",persist:!0,action:e=>(0,F.jsx)(p.c,{style:{color:"white"},onClick:()=>g(e),children:(0,F.jsx)(Y.KgB,{})})}})}})(),children:"Save Changes"})]})};const We=a.p+"static/media/python.b0fd2326ee21d9c5524d0d243379c879.svg";const Ye=a.p+"static/media/javascript.0baf38b3d3f5b2d24e87fb5cc2fcfea0.svg";const _e=a.p+"static/media/cURL.37eb8ccceafb9e8630a53aa0eb756128.svg";const Ge=a.p+"static/media/embed.289f71beedf481a4fab870e9fed16fec.svg",Xe=a.p+"static/media/sharing.932311c91d3fa05253cc.png";const Ve=a.p+"static/media/settings.b8495df74c95f19ef6411b17f7b81f27.svg";var Qe=a(17904),Ze=a(16828);function $e(e){const{children:t,value:a,index:n,...o}=e;return(0,F.jsx)("div",{role:"tabpanel",hidden:a!==n,id:"attachment-tabpanel-".concat(n),"aria-labelledby":"attachment-tab-".concat(n),...o,children:a===n&&(0,F.jsx)(h.c,{sx:{p:1},children:t})})}function et(e){return{id:"attachment-tab-".concat(e),"aria-controls":"attachment-tabpanel-".concat(e)}}const tt=e=>{var t,a;let{show:o,dialogProps:s,onCancel:r}=e;const l=document.getElementById("portal"),u=(0,c.i6)(),p=(0,i.OY)(),h=["Embed","Python","JavaScript","cURL","Share Chatbot","Configuration"],[m,f]=(0,n.useState)(0),[g,x]=(0,n.useState)([]),[y,w]=(0,n.useState)([]),[j,b]=(0,n.useState)(""),[C,S]=(0,n.useState)({}),[k,D]=(0,n.useState)(!1),[M,O]=(0,n.useState)({}),[N,E]=(0,n.useState)({}),R=(0,K.c)(Qe.c.getAllAPIKeys),B=(0,K.c)(Te.c.updateChatflow),q=(0,K.c)(Te.c.getIsChatflowStreaming),H=(0,K.c)(U),J=e=>{D(e),e&&H.request(s.chatflowid)},W=e=>(t,a)=>{const n={...N};n[e]=a,E(n)};(0,n.useEffect)((()=>{B.data&&p({type:d.kT,chatflow:B.data})}),[B.data,p]),(0,n.useEffect)((()=>{H.data&&function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const a={},n=e.reduce((function(e,n){return e[n.node]=e[n.node]||[],e[n.node].push(n),a[n.node]=!!t,e}),Object.create(null));O(n),E(a)}(H.data)}),[H.data]);const _=e=>"Python"===e?'import requests\n\nAPI_URL = "'.concat(z.OM,"/api/v1/prediction/").concat(s.chatflowid,'"\n\ndef query(payload):\n    response = requests.post(API_URL, json=payload)\n    return response.json()\n    \noutput = query({\n    "question": "Hey, how are you?",\n})\n'):"JavaScript"===e?'async function query(data) {\n    const response = await fetch(\n        "'.concat(z.OM,"/api/v1/prediction/").concat(s.chatflowid,'",\n        {\n            method: "POST",\n            headers: {\n                "Content-Type": "application/json"\n            },\n            body: JSON.stringify(data)\n        }\n    );\n    const result = await response.json();\n    return result;\n}\n\nquery({"question": "Hey, how are you?"}).then((response) => {\n    console.log(response);\n});\n'):"cURL"===e?"curl ".concat(z.OM,"/api/v1/prediction/").concat(s.chatflowid,' \\\n     -X POST \\\n     -d \'{"question": "Hey, how are you?"}\' \\\n     -H "Content-Type: application/json"'):"",G=e=>"Python"===e?'import requests\n\nAPI_URL = "'.concat(z.OM,"/api/v1/prediction/").concat(s.chatflowid,'"\nheaders = {"Authorization": "Bearer ').concat(null===C||void 0===C?void 0:C.apiKey,'"}\n\ndef query(payload):\n    response = requests.post(API_URL, headers=headers, json=payload)\n    return response.json()\n    \noutput = query({\n    "question": "Hey, how are you?",\n})\n'):"JavaScript"===e?'async function query(data) {\n    const response = await fetch(\n        "'.concat(z.OM,"/api/v1/prediction/").concat(s.chatflowid,'",\n        {\n            headers: {\n                Authorization: "Bearer ').concat(null===C||void 0===C?void 0:C.apiKey,'",\n                "Content-Type": "application/json"\n            },\n            method: "POST",\n            body: JSON.stringify(data)\n        }\n    );\n    const result = await response.json();\n    return result;\n}\n\nquery({"question": "Hey, how are you?"}).then((response) => {\n    console.log(response);\n});\n'):"cURL"===e?"curl ".concat(z.OM,"/api/v1/prediction/").concat(s.chatflowid,' \\\n     -X POST \\\n     -d \'{"question": "Hey, how are you?"}\' \\\n     -H "Content-Type: application/json" \\\n     -H "Authorization: Bearer ').concat(null===C||void 0===C?void 0:C.apiKey,'"'):"",X=e=>"Python"===e?"python":"JavaScript"===e?"javascript":"cURL"===e?"bash":"python",V=e=>"Python"===e?We:"JavaScript"===e?Ye:"Embed"===e?Ge:"cURL"===e?_e:"Share Chatbot"===e?Xe:"Configuration"===e?Ve:We,Q=(e,t)=>{if("Python"===e){let e=(t=(0,Ze.s7)(t))[0].type;return e.includes(",")&&(e=e.split(",")[0]),'import requests\n\nAPI_URL = "'.concat(z.OM,"/api/v1/prediction/").concat(s.chatflowid,'"\n\n# use form data to upload files\nform_data = {\n    "files": ',"('example".concat(e,"', open('example").concat(e,"', 'rb'))"),"\n}\nbody_data = {").concat((0,Ze.Qv)(t,"formData"),"}\n\ndef query(form_data):\n    response = requests.post(API_URL, files=form_data, data=body_data)\n    return response.json()\n\noutput = query(form_data)\n")}return"JavaScript"===e?"// use FormData to upload files\nlet formData = new FormData();\n".concat((0,Ze.Qf)(t,"formData"),'\nasync function query(formData) {\n    const response = await fetch(\n        "').concat(z.OM,"/api/v1/prediction/").concat(s.chatflowid,'",\n        {\n            method: "POST",\n            body: formData\n        }\n    );\n    const result = await response.json();\n    return result;\n}\n\nquery(formData).then((response) => {\n    console.log(response);\n});\n'):"cURL"===e?"curl ".concat(z.OM,"/api/v1/prediction/").concat(s.chatflowid," \\\n     -X POST \\").concat((0,Ze.qT)(t,"formData"),' \\\n     -H "Content-Type: multipart/form-data"'):""},Z=(e,t)=>{if("Python"===e){let e=(t=(0,Ze.s7)(t))[0].type;return e.includes(",")&&(e=e.split(",")[0]),'import requests\n\nAPI_URL = "'.concat(z.OM,"/api/v1/prediction/").concat(s.chatflowid,'"\nheaders = {"Authorization": "Bearer ').concat(null===C||void 0===C?void 0:C.apiKey,'"}\n\n# use form data to upload files\nform_data = {\n    "files": ',"('example".concat(e,"', open('example").concat(e,"', 'rb'))"),"\n}\nbody_data = {").concat((0,Ze.Qv)(t,"formData"),"}\n\ndef query(form_data):\n    response = requests.post(API_URL, headers=headers, files=form_data, data=body_data)\n    return response.json()\n\noutput = query(form_data)\n")}return"JavaScript"===e?"// use FormData to upload files\nlet formData = new FormData();\n".concat((0,Ze.Qf)(t,"formData"),'\nasync function query(formData) {\n    const response = await fetch(\n        "').concat(z.OM,"/api/v1/prediction/").concat(s.chatflowid,'",\n        {\n            headers: { Authorization: "Bearer ').concat(null===C||void 0===C?void 0:C.apiKey,'" },\n            method: "POST",\n            body: formData\n        }\n    );\n    const result = await response.json();\n    return result;\n}\n\nquery(formData).then((response) => {\n    console.log(response);\n});\n'):"cURL"===e?"curl ".concat(z.OM,"/api/v1/prediction/").concat(s.chatflowid," \\\n     -X POST \\").concat((0,Ze.qT)(t,"formData"),' \\\n     -H "Content-Type: multipart/form-data" \\\n     -H "Authorization: Bearer ').concat(null===C||void 0===C?void 0:C.apiKey,'"'):""},$=(e,t)=>"Python"===e?'import requests\n\nAPI_URL = "'.concat(z.OM,"/api/v1/prediction/").concat(s.chatflowid,'"\n\ndef query(payload):\n    response = requests.post(API_URL, json=payload)\n    return response.json()\n\noutput = query({\n    "question": "Hey, how are you?",\n    "overrideConfig": {').concat((0,Ze.Qv)(t,"json"),"\n    }\n})\n"):"JavaScript"===e?'async function query(data) {\n    const response = await fetch(\n        "'.concat(z.OM,"/api/v1/prediction/").concat(s.chatflowid,'",\n        {\n            method: "POST",\n            headers: {\n                "Content-Type": "application/json"\n            },\n            body: JSON.stringify(data)\n        }\n    );\n    const result = await response.json();\n    return result;\n}\n\nquery({\n  "question": "Hey, how are you?",\n  "overrideConfig": {').concat((0,Ze.Qf)(t,"json"),"\n  }\n}).then((response) => {\n    console.log(response);\n});\n"):"cURL"===e?"curl ".concat(z.OM,"/api/v1/prediction/").concat(s.chatflowid,' \\\n     -X POST \\\n     -d \'{"question": "Hey, how are you?", "overrideConfig": {').concat((0,Ze.qT)(t,"json"),'}\' \\\n     -H "Content-Type: application/json"'):"",ee=(e,t)=>"Python"===e?'import requests\n\nAPI_URL = "'.concat(z.OM,"/api/v1/prediction/").concat(s.chatflowid,'"\nheaders = {"Authorization": "Bearer ').concat(null===C||void 0===C?void 0:C.apiKey,'"}\n\ndef query(payload):\n    response = requests.post(API_URL, headers=headers, json=payload)\n    return response.json()\n\noutput = query({\n    "question": "Hey, how are you?",\n    "overrideConfig": {').concat((0,Ze.Qv)(t,"json"),"\n    }\n})\n"):"JavaScript"===e?'async function query(data) {\n    const response = await fetch(\n        "'.concat(z.OM,"/api/v1/prediction/").concat(s.chatflowid,'",\n        {\n            headers: {\n                Authorization: "Bearer ').concat(null===C||void 0===C?void 0:C.apiKey,'",\n                "Content-Type": "application/json"\n            },\n            method: "POST",\n            body: JSON.stringify(data)\n        }\n    );\n    const result = await response.json();\n    return result;\n}\n\nquery({\n  "question": "Hey, how are you?",\n  "overrideConfig": {').concat((0,Ze.Qf)(t,"json"),"\n  }\n}).then((response) => {\n    console.log(response);\n});\n"):"cURL"===e?"curl ".concat(z.OM,"/api/v1/prediction/").concat(s.chatflowid,' \\\n     -X POST \\\n     -d \'{"question": "Hey, how are you?", "overrideConfig": {').concat((0,Ze.qT)(t,"json"),'}\' \\\n     -H "Content-Type: application/json" \\\n     -H "Authorization: Bearer ').concat(null===C||void 0===C?void 0:C.apiKey,'"'):"",te=e=>"Python"===e?'body_data = {\n    "openAIApiKey[chatOpenAI_0]": "sk-my-openai-1st-key",\n    "openAIApiKey[openAIEmbeddings_0]": "sk-my-openai-2nd-key"\n}':"JavaScript"===e?'formData.append("openAIApiKey[chatOpenAI_0]", "sk-my-openai-1st-key")\nformData.append("openAIApiKey[openAIEmbeddings_0]", "sk-my-openai-2nd-key")':"cURL"===e?'-F "openAIApiKey[chatOpenAI_0]=sk-my-openai-1st-key" \\\n-F "openAIApiKey[openAIEmbeddings_0]=sk-my-openai-2nd-key" \\':void 0;(0,n.useEffect)((()=>{if(R.data){const e=[{label:"No Authorization",name:""}];for(const t of R.data)e.push({label:t.keyName,name:t.id});e.push({label:"- Add New Key -",name:"addnewkey"}),x(e),w(R.data),s.chatflowApiKeyId&&(b(s.chatflowApiKeyId),S(R.data.find((e=>e.id===s.chatflowApiKeyId))))}}),[s,R.data]),(0,n.useEffect)((()=>{o&&(R.request(),q.request(s.chatflowid))}),[o]);const ae=o?(0,F.jsxs)(I.c,{open:o,fullWidth:!0,maxWidth:"md",onClose:r,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[(0,F.jsx)(A.c,{sx:{fontSize:"1rem"},id:"alert-dialog-title",children:s.title}),(0,F.jsxs)(P.c,{children:[(0,F.jsxs)("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:[(0,F.jsx)("div",{style:{flex:80},children:(0,F.jsx)(he.c,{value:m,onChange:(e,t)=>{f(t)},"aria-label":"tabs",children:h.map(((e,t)=>(0,F.jsx)(me.c,{icon:(0,F.jsx)("img",{style:{objectFit:"cover",height:15,width:"auto"},src:V(e),alt:"code"}),iconPosition:"start",label:e,...et(t)},t)))})}),(0,F.jsx)("div",{style:{flex:20},children:(0,F.jsx)(we.c,{name:"SelectKey",disableClearable:!0,options:g,onSelect:e=>(e=>{if("addnewkey"===e)return void u("/apikey");b(e),S(y.find((t=>t.id===e)));const t={apikeyid:e};B.request(s.chatflowid,t)})(e),value:null!==(t=null!==(a=s.chatflowApiKeyId)&&void 0!==a?a:j)&&void 0!==t?t:"Choose an API key"})})]}),(0,F.jsx)("div",{style:{marginTop:10}}),h.map(((e,t)=>{var a;return(0,F.jsxs)($e,{value:m,index:t,children:[("Embed"===e||"Share Chatbot"===e)&&j&&(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)("p",{children:"You cannot use API key while embedding/sharing chatbot."}),(0,F.jsxs)("p",{children:["Please select ",(0,F.jsx)("b",{children:'"No Authorization"'})," from the dropdown at the top right corner."]})]}),"Embed"===e&&!j&&(0,F.jsx)(Je,{chatflowid:s.chatflowid}),"Embed"!==e&&"Share Chatbot"!==e&&"Configuration"!==e&&(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)(ye.UD,{theme:ye.ig,text:j?G(e):_(e),language:X(e),showLineNumbers:!1,wrapLines:!0}),(0,F.jsx)(Fe,{label:"Show Input Config",value:k,onChange:J}),k&&H.data&&H.data.length>0&&(0,F.jsxs)(F.Fragment,{children:[Object.keys(M).sort().map((e=>(0,F.jsxs)(fe.c,{expanded:N[e]||!1,onChange:W(e),disableGutters:!0,children:[(0,F.jsx)(ge.c,{expandIcon:(0,F.jsx)(ve.c,{}),"aria-controls":"nodes-accordian-".concat(e),id:"nodes-accordian-header-".concat(e),children:(0,F.jsxs)("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:[(0,F.jsx)(v.c,{variant:"h5",children:e}),(0,F.jsx)("div",{style:{display:"flex",flexDirection:"row",width:"max-content",borderRadius:15,background:"rgb(254,252,191)",padding:5,paddingLeft:10,paddingRight:10,marginLeft:10},children:(0,F.jsx)("span",{style:{color:"rgb(116,66,16)",fontSize:"0.825rem"},children:M[e][0].nodeId})})]})}),(0,F.jsx)(xe.c,{children:(0,F.jsx)(L,{rows:M[e].map((e=>{const{node:t,nodeId:a,...n}=e;return n})),columns:Object.keys(M[e][0]).slice(-3)})})]},e))),(0,F.jsx)(ye.UD,{theme:ye.ig,text:j?s.isFormDataRequired?Z(e,H.data):ee(e,H.data):s.isFormDataRequired?Q(e,H.data):$(e,H.data),language:X(e),showLineNumbers:!1,wrapLines:!0}),(0,F.jsxs)("div",{style:{display:"flex",flexDirection:"column",borderRadius:10,background:"#d8f3dc",padding:10,marginTop:10,marginBottom:10},children:[(0,F.jsxs)("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:[(0,F.jsx)(Y.CI$,{size:30,color:"#2d6a4f"}),(0,F.jsx)("span",{style:{color:"#2d6a4f",marginLeft:10,fontWeight:500},children:"You can also specify multiple values for a config parameter by specifying the node id"})]}),(0,F.jsx)("div",{style:{padding:10},children:(0,F.jsx)(ye.UD,{theme:ye.ig,text:s.isFormDataRequired?te(e):'{\n    "overrideConfig": {\n        "openAIApiKey": {\n            "chatOpenAI_0": "sk-my-openai-1st-key",\n            "openAIEmbeddings_0": "sk-my-openai-2nd-key"\n        }\n    }\n}',language:X(e),showLineNumbers:!1,wrapLines:!0})})]})]}),(null===(a=q.data)||void 0===a?void 0:a.isStreaming)&&(0,F.jsxs)("p",{children:["Read\xa0",(0,F.jsx)("a",{rel:"noreferrer",target:"_blank",href:"https://docs.flowiseai.com/how-to-use#streaming",children:"here"}),"\xa0on how to stream response back to application"]})]}),"Share Chatbot"===e&&!j&&(0,F.jsx)(Re,{isSessionMemory:s.isSessionMemory}),"Configuration"===e&&(0,F.jsx)(Ke,{})]},t)}))]})]}):null;return(0,T.createPortal)(ae,l)};var at=a(62168),nt=a(46900),ot=a(18436),st=a(54528),rt=a(14180),it=a(5220),ct=a(38154);const lt=[{label:"LangSmith",name:"langSmith",icon:a.p+"static/media/langchain.03999e05472fc2689e39.png",url:"https://smith.langchain.com",inputs:[{label:"Connect Credential",name:"credential",type:"credential",credentialNames:["langsmithApi"]},{label:"Project Name",name:"projectName",type:"string",optional:!0,description:"If not provided, default will be used",placeholder:"default"},{label:"On/Off",name:"status",type:"boolean",optional:!0}]},{label:"LangFuse",name:"langFuse",icon:a.p+"static/media/langfuse.428d797f60a43ef7494f.png",url:"https://langfuse.com",inputs:[{label:"Connect Credential",name:"credential",type:"credential",credentialNames:["langfuseApi"]},{label:"Release",name:"release",type:"string",optional:!0,description:"The release number/hash of the application to provide analytics grouped by release"},{label:"On/Off",name:"status",type:"boolean",optional:!0}]},{label:"LLMonitor",name:"llmonitor",icon:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAIAAADYYG7QAAAGhUlEQVR4nOxYW0wj1xmeiz228R1fMNgG24BhMWA2BTY0CbQhSpU0aqVm2436QNRKvTxU6kNfou4qrdSmqdJWfc1L+9CumrbartRtpJWiQFQoS7XswmIuxmB8xRjfsAcbMx57ZiowHsb2+LaqNjzwPc3555z/fHP+c77/P8P5+kefAhcJ0OdNoBSXhGrhklAtXDhCnKcfCYGdckmHTKgQ8JsQDkBRSTwbTWdc8aQ3kaKeGSEQAEa1qpeNrUOaZh4HZu2TwrMPA9FPXXsbkUTD/hsSxjG9+tsDJr1EWGd/eyTxpxWnPYr+/wmJEM6Pr1lGtMr6XdO4v737h+WtHFlXGOsKmU7SdGt8SCMSMI3hI2wxENmMooFkOoVnYRAUIdx2qfCKSjaqVUp4CN3ztW6dUS7+1dzKYSZbc64aK8SFIb1E+LOJISn/fAJ7NPG3NfeT/YNKo2AQfKFd/S2LUccIrh89ujXzGK3FqSKhFqHgh8M9gxoFDJ4bsRzxx+WtT3b2qjs9owWBNyzG6xYjLS3bMfTmzBJOkNVG9V6fKrcKuZzfvDrS2SyBGGxiaezdz5YfB2P1sAEAgKKA1XDcGTu8plNxoBNWiiZ+s4D3MBCtMopdGCdNrcomfolx1hvyJFJ1sqHxOBj7YH6VXpRJU9vV1uaGCWnFTeVGnYTFCENgr1L6JYNmokPTrZBAIFjeZykY++vaDt1829pdhRD7KYtjeLkxms4wmzwY+kaf4fUunZjHpY0JDL/n8N1z+EoO+T/snjG92iQXAwBgkIlG2pSLe+yBY1+haVcQy+aYlhxJfrIToJtqIf+3Xxm9YTEy2QAAIOMjU9auX78yLGOcSgAASAq4bTtfpFc721jnrUgoksbe/88qWlindDb3+4V1d2ED8WDo3YmhKnrd1Sy5+dIgXBy+pWBsP5XOPw9pFJXSTkVhXAkdfO9f8+bTbbEdOzzOEfSr630GWmAIkvzMs/9k/wACgeE25YsdmvwndiukXzXr7jn8TJ/zvvCbfYa8vF1RSlmVrJpS4wS5Fi7NjhwIfL1bV2BDvTdnWyoIwaw3tBiI/uSL/fnm13raSwhtRBJvFp475WJWQg3XQ71KqRA52zfT7r2lYlma84UW/OH8s7KJ3yEtCqvz4JBkfBir/4YJqYTnGW2ZTSSZFEvSH5rJ/sW2k8kRWzH0vjPA6p89ZGoh/50XB1uE/Nu2nbKR5+eZTXROK6byrgXc2fDc2fCwTpoH+wq9Ydab5GIhwv3uVTMPLuoTTmH083OtLNXIMMO4nzquMncDhHLkWay5MNQuFTFfOWJoCj/L2C+b2kaLK6QvGzTXdKoz6keYDz1qlBB7yFzxJP080CLfPjhkcKU+3vK/1W/Kf807L1nnPPsroQMQODn2Y3o13fOfm16mTwmPa1ZIcYLYjKJVEj47ofVwgiys3gt69V17keu7du+YTt0hE+U5TRg0EwZNiQd7NHHfuUs3X+vSfueqGTmNfvw488H8aqW6lj1kcQx3FOrzzmZJj0LKfIsT5C9mn3grZ35HFH1/zkZns8EW+Q+Ge5HCXpQLeDfHrZLinEODvR46ET2Kel53tv5aSdO0O8h8m84S064gTpDtUhGfkQSiaeyjVdeHjxwYQ9mnrF0lGxGB4dhxZit2WD5vRaWe84be6jflhaRPJXvDrP94q0h2syR5Z8Nz1+41yUVqoYA6OVNpT5zlRiYTIOX+lQIe67wVhZGgqD/bnHTzbWuXRSUr70ZSlPMg+cAfXvCH3WxsAAAIJlkOv7tCxKsp9bwvvLB7lge4MPTTcetAi7xKf1YMqOVjOnWJ0YemHhQyTAkq7qE8lvZiI1plvrhBYGiioxUAqM0oWs8VCwbBb1oMPxq18Djnn40TxH93I79bWE8X11s0al8UFQLee5PPaUTn9asPPfr7umvBHyEodmIwCD6vV92wGJl7OZQ6/vm/l0MpjKwwql5CpwcVuTU+1HlagNJAMXxxL+o4vSgmMJyiKCkf0UmEV5TSYa1SyivayO548pezK7HjTM256r1KIzD0/S/0vGKqWHpWwYw7+OGjzerXsYYJ5dGvlk9ZO83FOlkFW7HD2zanLRSvf4rGCOVhUcsmjW0jWqUYYVfbJJ5dDERn3MG1cANU8niaH1br4cR6OAECgF4qNMrEahGfB5+IdSZHRNKYK570o0fP7ocVDer0uD1FgVEdF+4f4yWhWrgkVAsXjtD/AgAA///a3JKR/wDzvwAAAABJRU5ErkJggg==",url:"https://llmonitor.com",inputs:[{label:"Connect Credential",name:"credential",type:"credential",credentialNames:["llmonitorApi"]},{label:"On/Off",name:"status",type:"boolean",optional:!0}]}],dt=e=>{let{show:t,dialogProps:a,onCancel:o}=e;const s=document.getElementById("portal"),r=(0,i.OY)();(0,Ie.c)();const c=function(){return r((0,d.mq)(...arguments))},l=function(){return r((0,d.EF)(...arguments))},[u,m]=(0,n.useState)({}),[f,g]=(0,n.useState)({}),x=(e,t,a)=>{let n={};n=Object.prototype.hasOwnProperty.call(u,t)?{...u}:{...u,[t]:{}},n[t][a]=e,m(n)};(0,n.useEffect)((()=>{if(a.chatflow&&a.chatflow.analytic)try{m(JSON.parse(a.chatflow.analytic))}catch(e){m({}),console.error(e)}return()=>{m({}),g({})}}),[a]),(0,n.useEffect)((()=>(r(t?{type:d.wp}:{type:d.OC}),()=>r({type:d.OC}))),[t,r]);const y=t?(0,F.jsxs)(I.c,{onClose:o,open:t,fullWidth:!0,maxWidth:"sm","aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[(0,F.jsx)(A.c,{sx:{fontSize:"1rem"},id:"alert-dialog-title",children:"Analyse Chatflow"}),(0,F.jsx)(P.c,{children:lt.map(((e,t)=>{return(0,F.jsxs)(fe.c,{expanded:f[e.name]||!1,onChange:(a=e.name,(e,t)=>{const n={...f};n[a]=t,g(n)}),disableGutters:!0,children:[(0,F.jsx)(ge.c,{expandIcon:(0,F.jsx)(ve.c,{}),"aria-controls":e.name,id:e.name,children:(0,F.jsxs)(at.cp,{style:{padding:0,margin:0},alignItems:"center",children:[(0,F.jsx)(nt.c,{children:(0,F.jsx)("div",{style:{width:50,height:50,borderRadius:"50%",backgroundColor:"white"},children:(0,F.jsx)("img",{style:{width:"100%",height:"100%",padding:10,objectFit:"contain"},alt:"AI",src:e.icon})})}),(0,F.jsx)(ot.c,{sx:{ml:1},primary:e.label,secondary:(0,F.jsx)("a",{target:"_blank",rel:"noreferrer",href:e.url,children:e.url})}),u[e.name]&&u[e.name].status&&(0,F.jsxs)("div",{style:{display:"flex",flexDirection:"row",alignContent:"center",alignItems:"center",background:"#d8f3dc",borderRadius:15,padding:5,paddingLeft:7,paddingRight:7,marginRight:10},children:[(0,F.jsx)("div",{style:{width:15,height:15,borderRadius:"50%",backgroundColor:"#70e000"}}),(0,F.jsx)("span",{style:{color:"#006400",marginLeft:10},children:"ON"})]})]})}),(0,F.jsx)(xe.c,{children:e.inputs.map(((t,a)=>{var n,o;return(0,F.jsxs)(h.c,{sx:{p:2},children:[(0,F.jsx)("div",{style:{display:"flex",flexDirection:"row"},children:(0,F.jsxs)(v.c,{children:[t.label,!t.optional&&(0,F.jsx)("span",{style:{color:"red"},children:"\xa0*"}),t.description&&(0,F.jsx)(De.c,{style:{marginLeft:10},title:t.description})]})}),f[e.name]&&"credential"===t.type&&(0,F.jsx)(rt.c,{data:u[e.name]?{credential:u[e.name].credentialId}:{},inputParam:t,onSelect:t=>x(t,e.name,"credentialId")}),f[e.name]&&"boolean"===t.type&&(0,F.jsx)(it._,{onChange:a=>x(a,e.name,t.name),value:u[e.name]?u[e.name][t.name]:null!==(n=t.default)&&void 0!==n&&n}),f[e.name]&&("string"===t.type||"password"===t.type||"number"===t.type)&&(0,F.jsx)(ct.E,{inputParam:t,onChange:a=>x(a,e.name,t.name),value:u[e.name]?u[e.name][t.name]:null!==(o=t.default)&&void 0!==o?o:""})]},a)}))})]},t);var a}))}),(0,F.jsx)(st.c,{children:(0,F.jsx)(ke.y,{variant:"contained",onClick:async()=>{try{const e=await Te.c.updateChatflow(a.chatflow.id,{analytic:JSON.stringify(u)});e.data&&(c({message:"Analytic Configuration Saved",options:{key:(new Date).getTime()+Math.random(),variant:"success",action:e=>(0,F.jsx)(p.c,{style:{color:"white"},onClick:()=>l(e),children:(0,F.jsx)(Y.KgB,{})})}}),r({type:d.kT,chatflow:e.data})),o()}catch(e){const t=e.response.data||"".concat(e.response.status,": ").concat(e.response.statusText);c({message:"Failed to save Analytic Configuration: ".concat(t),options:{key:(new Date).getTime()+Math.random(),variant:"error",persist:!0,action:e=>(0,F.jsx)(p.c,{style:{color:"white"},onClick:()=>l(e),children:(0,F.jsx)(Y.KgB,{})})}})}},children:"Save"})})]}):null;return(0,T.createPortal)(y,s)};var ut=a(40136),pt=a.n(ut),ht=a(69744),mt=a(37212),ft=a(35412),gt=a(22736),xt=a(30938),yt=a(50944),vt=a(47280),wt=a(15216),jt=a.n(wt),bt=a(18548);const Ct=a.p+"static/media/account.bccec459ac1b2deab2d2.png";const St=a.p+"static/media/message_empty.e64ce71827642b3667c24731d5cfaaa0.svg";var kt=a(356),Dt=a(31680),Tt=a(78824),It=a.n(Tt);const At=e=>{var t;let{show:a,dialogProps:o,onCancel:s}=e;const r=document.getElementById("portal"),c=(0,i.w1)((e=>e.customization)),[l,d]=(0,n.useState)({});(0,n.useEffect)((()=>(o.data&&d(o.data),()=>{d({})})),[o]);const u=a?(0,F.jsxs)(I.c,{onClose:s,open:a,fullWidth:!0,maxWidth:"sm","aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[(0,F.jsx)(A.c,{sx:{fontSize:"1rem"},id:"alert-dialog-title",children:null!==(t=o.title)&&void 0!==t?t:"Source Documents"}),(0,F.jsx)(P.c,{children:(0,F.jsx)(It(),{theme:c.isDarkMode?"ocean":"rjv-default",style:{padding:10,borderRadius:10},src:l,name:null,quotesOnKeys:!1,enableClipboard:!1,displayDataTypes:!1})})]}):null;return(0,T.createPortal)(u,r)};var Pt=a(1604);const Mt=e=>H.c.get("/internal-chatmessage/".concat(e)),Ot=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return H.c.get("/chatmessage/".concat(e),{params:{order:"DESC",...t}})},Nt=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return H.c.get("/chatmessage/".concat(e),{params:{order:"ASC",...t}})},Et=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return H.c.delete("/chatmessage/".concat(e),{params:{...t}})};var Rt=a(78256);a(79004);const Bt=(0,n.forwardRef)((function(e,t){let{value:a,onClick:n}=e;return(0,F.jsx)(yt.c,{style:{borderRadius:15,border:"1px solid #e0e0e0"},onClick:n,ref:t,children:a})})),qt=e=>{let{show:t,dialogProps:a,onCancel:o}=e;const s=document.getElementById("portal"),r=(0,i.OY)(),c=(0,g.c)(),l=(0,i.w1)((e=>e.customization)),{confirm:u}=(0,Rt.c)();(0,Ie.c)();const m=function(){return r((0,d.mq)(...arguments))},f=function(){return r((0,d.EF)(...arguments))},[x,y]=(0,n.useState)([]),[v,w]=(0,n.useState)([]),[b,C]=(0,n.useState)([]),[S,k]=(0,n.useState)(0),[D,M]=(0,n.useState)(!1),[O,N]=(0,n.useState)({}),[E,R]=(0,n.useState)([]),[B,q]=(0,n.useState)((new Date).setMonth((new Date).getMonth()-1)),[L,H]=(0,n.useState)(new Date),U=(0,K.c)(Ot),J=(0,K.c)(Nt),W=e=>{var t,a;const n=e.chatId,o=null!==(t=e.memoryType)&&void 0!==t?t:"null",s=null!==(a=e.sessionId)&&void 0!==a?a:"null";return"".concat(n,"_").concat(o,"_").concat(s)},_=e=>{let[t,a,...n]=e.split("_");const o=t,s=a,r=n.join("_"),i={chatId:o};return"null"!==s&&(i.memoryType=s),"null"!==r&&(i.sessionId=r),i},G=(e,t)=>{N({data:e,title:t}),M(!0)};(0,n.useEffect)((()=>{J.data&&(e=>{let t="";const a=[];for(let n=0;n<e.length;n+=1){const o=e[n];if(t){const e=o.createdDate.split("T")[0];e!==t&&(t=e,a.push({message:o.createdDate,type:"timeMessage"}))}else t=o.createdDate.split("T")[0],a.push({message:o.createdDate,type:"timeMessage"});const s={...o,message:o.content,type:o.role};o.sourceDocuments&&(s.sourceDocuments=JSON.parse(o.sourceDocuments)),o.usedTools&&(s.usedTools=JSON.parse(o.usedTools)),o.fileAnnotations&&(s.fileAnnotations=JSON.parse(o.fileAnnotations)),a.push(s)}C(a)})(J.data)}),[J.data]),(0,n.useEffect)((()=>{if(U.data){w(U.data);const e=(e=>{const t={},a=[];for(let n=0;n<e.length;n+=1){const o=W(e[n]),s=e[n];Object.prototype.hasOwnProperty.call(t,o)?Object.prototype.hasOwnProperty.call(t,o)&&1===t[o].counter&&(t[o]={counter:2,item:{...t[o].item,apiContent:"apiMessage"===t[o].item.role?"Bot: ".concat(t[o].item.content):"User: ".concat(t[o].item.content),userContent:"apiMessage"===s.role?"Bot: ".concat(s.content):"User: ".concat(s.content)}},a.push(t[o].item)):t[o]={counter:1,item:e[n]}}if(y(a),a.length)return W(a[0])})(U.data);k(0),e&&J.request(a.chatflow.id,_(e))}}),[U.data]),(0,n.useEffect)((()=>(a.chatflow&&U.request(a.chatflow.id),()=>{y([]),w([]),C([]),R([]),k(0),q((new Date).setMonth((new Date).getMonth()-1)),H(new Date)})),[a]),(0,n.useEffect)((()=>(r(t?{type:d.wp}:{type:d.OC}),()=>r({type:d.OC}))),[t,r]);const X=t?(0,F.jsxs)(I.c,{onClose:o,open:t,fullWidth:!0,maxWidth:x&&0==x.length?"md":"lg","aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[(0,F.jsx)(A.c,{sx:{fontSize:"1rem"},id:"alert-dialog-title",children:(0,F.jsxs)("div",{style:{display:"flex",flexDirection:"row"},children:[a.title,(0,F.jsx)("div",{style:{flex:1}}),(0,F.jsx)(p.c,{variant:"outlined",onClick:()=>(()=>{const e={};for(let a=0;a<v.length;a+=1){const o=v[a],s=W(o),r={content:o.content,role:"apiMessage"===o.role?"bot":"user",time:o.createdDate};var t,n;o.sourceDocuments&&(r.sourceDocuments=JSON.parse(o.sourceDocuments)),o.usedTools&&(r.usedTools=JSON.parse(o.usedTools)),o.fileAnnotations&&(r.fileAnnotations=JSON.parse(o.fileAnnotations)),Object.prototype.hasOwnProperty.call(e,s)?Object.prototype.hasOwnProperty.call(e,s)&&(e[s].messages=[...e[s].messages,r]):e[s]={id:o.chatId,source:"INTERNAL"===o.chatType?"UI":"API/Embed",sessionId:null!==(t=o.sessionId)&&void 0!==t?t:null,memoryType:null!==(n=o.memoryType)&&void 0!==n?n:null,messages:[r]}}const o=[];for(const a in e)o.push({...e[a]});for(let a=0;a<o.length;a+=1)o[a].messages=o[a].messages.reverse();const s=JSON.stringify(o,null,2),r="data:application/json;charset=utf-8,"+encodeURIComponent(s),i="".concat(a.chatflow.id,"-Message.json");let c=document.createElement("a");c.setAttribute("href",r),c.setAttribute("download",i),c.click()})(),startIcon:(0,F.jsx)(Y.y_w,{}),children:"Export"})]})}),(0,F.jsx)(P.c,{children:(0,F.jsxs)(F.Fragment,{children:[(0,F.jsxs)("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",width:"100%",marginBottom:10},children:[(0,F.jsxs)("div",{style:{marginRight:10},children:[(0,F.jsx)("b",{style:{marginRight:10},children:"From Date"}),(0,F.jsx)(jt(),{selected:B,onChange:e=>(e=>{q(e),U.request(a.chatflow.id,{startDate:e,endDate:L,chatType:E.length?E:void 0})})(e),selectsStart:!0,startDate:B,endDate:L,customInput:(0,F.jsx)(Bt,{})})]}),(0,F.jsxs)("div",{style:{marginRight:10},children:[(0,F.jsx)("b",{style:{marginRight:10},children:"To Date"}),(0,F.jsx)(jt(),{selected:L,onChange:e=>(e=>{H(e),U.request(a.chatflow.id,{endDate:e,startDate:B,chatType:E.length?E:void 0})})(e),selectsEnd:!0,startDate:B,endDate:L,minDate:B,maxDate:new Date,customInput:(0,F.jsx)(Bt,{})})]}),(0,F.jsxs)("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",minWidth:"200px",marginRight:10},children:[(0,F.jsx)("b",{style:{marginRight:10},children:"Source"}),(0,F.jsx)(Pt.m,{name:"chatType",options:[{label:"UI",name:"INTERNAL"},{label:"API/Embed",name:"EXTERNAL"}],onSelect:e=>{return R(t=e),void U.request(a.chatflow.id,{chatType:t.length?t:void 0,startDate:B,endDate:L});var t},value:E,formControlSx:{mt:0}},JSON.stringify(E))]}),(0,F.jsx)("div",{style:{flex:1}})]}),(0,F.jsxs)("div",{style:{display:"flex",flexDirection:"row"},children:[x&&0==x.length&&(0,F.jsxs)(ee.c,{sx:{alignItems:"center",justifyContent:"center",width:"100%"},flexDirection:"column",children:[(0,F.jsx)(h.c,{sx:{p:5,height:"auto"},children:(0,F.jsx)("img",{style:{objectFit:"cover",height:"20vh",width:"auto"},src:St,alt:"msgEmptySVG"})}),(0,F.jsx)("div",{children:"No Messages"})]}),x&&x.length>0&&(0,F.jsx)("div",{style:{flexBasis:"40%"},children:(0,F.jsx)(h.c,{sx:{overflowY:"auto",display:"flex",flexGrow:1,flexDirection:"column",maxHeight:"calc(100vh - 260px)"},children:x.map(((e,t)=>(0,F.jsx)(yt.c,{sx:{p:0,borderRadius:"".concat(l.borderRadius,"px"),boxShadow:"0 2px 14px 0 rgb(32 40 45 / 8%)",mt:1,ml:1,mr:1,mb:t===x.length-1?1:0},selected:S===t,onClick:()=>((e,t)=>{k(e),J.request(a.chatflow.id,_(W(t)))})(t,e),children:(0,F.jsx)(at.cp,{alignItems:"center",children:(0,F.jsx)(ot.c,{primary:(0,F.jsxs)("div",{style:{display:"flex",flexDirection:"column",marginBottom:10},children:[(0,F.jsx)("span",{children:null===e||void 0===e?void 0:e.userContent}),(0,F.jsx)("div",{style:{maxHeight:"100px",maxWidth:"400px",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:null===e||void 0===e?void 0:e.apiContent})]}),secondary:pt()(e.createdDate).format("MMMM Do YYYY, h:mm:ss a")})})},t)))})}),x&&x.length>0&&(0,F.jsxs)("div",{style:{flexBasis:"60%",paddingRight:"30px"},children:[b&&b.length>1&&(0,F.jsxs)("div",{style:{display:"flex",flexDirection:"row"},children:[(0,F.jsxs)("div",{style:{flex:1,marginLeft:"20px",marginBottom:"15px",marginTop:"10px"},children:[b[1].sessionId&&(0,F.jsxs)("div",{children:["Session Id:\xa0",(0,F.jsx)("b",{children:b[1].sessionId})]}),b[1].chatType&&(0,F.jsxs)("div",{children:["Source:\xa0",(0,F.jsx)("b",{children:"INTERNAL"===b[1].chatType?"UI":"API/Embed"})]}),b[1].memoryType&&(0,F.jsxs)("div",{children:["Memory:\xa0",(0,F.jsx)("b",{children:b[1].memoryType})]})]}),(0,F.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignContent:"center",alignItems:"end"},children:[(0,F.jsx)(ke.y,{sx:{height:"max-content",width:"max-content"},variant:"outlined",color:"error",title:"Clear Message",onClick:()=>(async e=>{const t={title:"Clear Session",description:e.sessionId&&e.memoryType?"Are you sure you want to clear session id: ".concat(e.sessionId," from ").concat(e.memoryType,"?"):"Are you sure you want to clear messages?",confirmButtonName:"Clear",cancelButtonName:"Cancel"},n=await u(t),o=a.chatflow.id;if(n)try{const t={chatflowid:o,isClearFromViewMessageDialog:!0};e.chatId&&(t.chatId=e.chatId),e.chatType&&(t.chatType=e.chatType),e.memoryType&&(t.memoryType=e.memoryType),e.sessionId&&(t.sessionId=e.sessionId),await Et(o,t);const a=e.sessionId&&e.memoryType?"Succesfully cleared session id: ".concat(e.sessionId," from ").concat(e.memoryType):"Succesfully cleared messages";m({message:a,options:{key:(new Date).getTime()+Math.random(),variant:"success",action:e=>(0,F.jsx)(p.c,{style:{color:"white"},onClick:()=>f(e),children:(0,F.jsx)(Y.KgB,{})})}}),U.request(o)}catch(s){const e=s.response.data||"".concat(s.response.status,": ").concat(s.response.statusText);m({message:e,options:{key:(new Date).getTime()+Math.random(),variant:"error",persist:!0,action:e=>(0,F.jsx)(p.c,{style:{color:"white"},onClick:()=>f(e),children:(0,F.jsx)(Y.KgB,{})})}})}})(b[1]),startIcon:(0,F.jsx)(Y.ukq,{}),children:"Clear"}),b[1].sessionId&&(0,F.jsx)(j.c,{title:"At your left \ud83d\udc48 you will see the Memory node that was used in this conversation. You need to have the matching Memory node with same parameters in the canvas, in order to delete the session conversations stored on the Memory node",placement:"bottom",children:(0,F.jsx)("h5",{style:{cursor:"pointer",color:c.palette.primary.main},children:"Why my session is not deleted?"})})]})]}),(0,F.jsx)("div",{style:{marginLeft:"20px",border:"1px solid #e0e0e0",borderRadius:"".concat(l.borderRadius,"px")},className:"cloud-message",children:(0,F.jsx)("div",{style:{width:"100%",height:"100%"},children:b&&b.map(((e,t)=>"apiMessage"===e.type||"userMessage"===e.type?(0,F.jsxs)(h.c,{sx:{background:"apiMessage"===e.type?c.palette.asyncSelect.main:"",pl:1,pr:1},style:{display:"flex",justifyContent:"center",alignContent:"center"},children:["apiMessage"===e.type?(0,F.jsx)("img",{style:{marginLeft:"10px"},src:bt,alt:"AI",width:"25",height:"25",className:"boticon"}):(0,F.jsx)("img",{style:{marginLeft:"10px"},src:Ct,alt:"Me",width:"25",height:"25",className:"usericon"}),(0,F.jsxs)("div",{style:{display:"flex",flexDirection:"column",width:"100%"},children:[e.usedTools&&(0,F.jsx)("div",{style:{display:"block",flexDirection:"row",width:"100%"},children:e.usedTools.map(((e,t)=>(0,F.jsx)(vt.c,{size:"small",label:e.tool,component:"a",sx:{mr:1,mt:1},variant:"outlined",clickable:!0,onClick:()=>G(e,"Used Tools")},t)))}),(0,F.jsx)("div",{className:"markdownanswer",children:(0,F.jsx)(kt.I,{remarkPlugins:[ft.c,gt.c],rehypePlugins:[ht.c,mt.c],components:{code(e){let{inline:t,className:n,children:o,...s}=e;const r=/language-(\w+)/.exec(n||"");return t?(0,F.jsx)("code",{className:n,...s,children:o}):(0,F.jsx)(Dt.s,{chatflowid:a.chatflow.id,isDialog:!0,language:r&&r[1]||"",value:String(o).replace(/\n$/,""),...s},Math.random())}},children:e.message})}),e.fileAnnotations&&(0,F.jsx)("div",{style:{display:"block",flexDirection:"row",width:"100%"},children:e.fileAnnotations.map(((e,t)=>(0,F.jsx)(p.c,{sx:{fontSize:"0.85rem",textTransform:"none",mb:1,mr:1},variant:"outlined",onClick:()=>(async e=>{try{const t=await xt.c.post("".concat(z.OM,"/api/v1/openai-assistants-file"),{fileName:e.fileName},{responseType:"blob"}),a=new Blob([t.data],{type:t.headers["content-type"]}),n=window.URL.createObjectURL(a),o=document.createElement("a");o.href=n,o.download=e.fileName,document.body.appendChild(o),o.click(),o.remove()}catch(t){console.error("Download failed:",t)}})(e),endIcon:(0,F.jsx)(Y.snM,{color:c.palette.primary.main}),children:e.fileName},t)))}),e.sourceDocuments&&(0,F.jsx)("div",{style:{display:"block",flexDirection:"row",width:"100%"},children:(0,Ze.eA)(e).map(((e,t)=>{const a=e.metadata&&e.metadata.source?(0,Ze.a)(e.metadata.source):void 0;return(0,F.jsx)(vt.c,{size:"small",label:a?"/"===a.pathname.substring(0,15)?a.host:"".concat(a.pathname.substring(0,15),"..."):"".concat(e.pageContent.substring(0,15),"..."),component:"a",sx:{mr:1,mb:1},variant:"outlined",clickable:!0,onClick:()=>{return a?(t=e.metadata.source,void window.open(t,"_blank")):G(e);var t}},t)}))})]})]},t):(0,F.jsx)(h.c,{sx:{background:c.palette.timeMessage.main,p:2},style:{display:"flex",justifyContent:"center",alignContent:"center"},children:pt()(e.message).format("MMMM Do YYYY, h:mm:ss a")},t)))})})]})]}),(0,F.jsx)(At,{show:D,dialogProps:O,onCancel:()=>M(!1)})]})})]}):null;return(0,T.createPortal)(X,s)};var Ft=a(36572);const Lt=e=>{let{chatflow:t,handleSaveFlow:a,handleDeleteFlow:o,handleLoadFlow:s}=e;const r=(0,g.c)(),l=(0,i.OY)(),u=(0,c.i6)(),p=(0,n.useRef)(),m=(0,n.useRef)(),[f,x]=(0,n.useState)(null),[y,w]=(0,n.useState)(""),[j,b]=(0,n.useState)(!1),[C,S]=(0,n.useState)(!1),[k,D]=(0,n.useState)(!1),[T,I]=(0,n.useState)({}),[A,P]=(0,n.useState)(!1),[M,O]=(0,n.useState)({}),[N,E]=(0,n.useState)(!1),[R,B]=(0,n.useState)({}),[q,L]=(0,n.useState)(!1),[H,U]=(0,n.useState)({}),J=(0,K.c)(Te.c.updateChatflow),W=(0,i.w1)((e=>e.canvas));return(0,n.useEffect)((()=>{J.data&&(w(J.data.name),l({type:d.kT,chatflow:J.data})),x(!1)}),[J.data]),(0,n.useEffect)((()=>{t&&w(t.name)}),[t]),(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)(h.c,{children:(0,F.jsx)(Z.c,{title:"Back",sx:{borderRadius:"50%"},children:(0,F.jsx)($.c,{variant:"rounded",sx:{...r.typography.commonAvatar,...r.typography.mediumAvatar,transition:"all .2s ease-in-out",background:r.palette.secondary.light,color:r.palette.secondary.dark,"&:hover":{background:r.palette.secondary.dark,color:r.palette.secondary.light}},color:"inherit",onClick:()=>window.history.state&&window.history.state.idx>0?u(-1):u("/",{replace:!0}),children:(0,F.jsx)(Y.C4Y,{stroke:1.5,size:"1.3rem"})})})}),(0,F.jsxs)(h.c,{sx:{flexGrow:1},children:[!f&&(0,F.jsxs)(ee.c,{flexDirection:"row",children:[(0,F.jsxs)(v.c,{sx:{fontSize:"1.5rem",fontWeight:600,ml:2},children:[W.isDirty&&(0,F.jsx)("strong",{style:{color:r.palette.orange.main},children:"*"})," ",y]}),(null===t||void 0===t?void 0:t.id)&&(0,F.jsx)(Z.c,{title:"Edit Name",sx:{borderRadius:"50%"},children:(0,F.jsx)($.c,{variant:"rounded",sx:{...r.typography.commonAvatar,...r.typography.mediumAvatar,transition:"all .2s ease-in-out",ml:1,background:r.palette.secondary.light,color:r.palette.secondary.dark,"&:hover":{background:r.palette.secondary.dark,color:r.palette.secondary.light}},color:"inherit",onClick:()=>x(!0),children:(0,F.jsx)(Y.U1l,{stroke:1.5,size:"1.3rem"})})})]}),f&&(0,F.jsxs)(ee.c,{flexDirection:"row",children:[(0,F.jsx)(te.c,{size:"small",inputRef:p,sx:{width:"50%",ml:2},defaultValue:y}),(0,F.jsx)(Z.c,{title:"Save Name",sx:{borderRadius:"50%"},children:(0,F.jsx)($.c,{variant:"rounded",sx:{...r.typography.commonAvatar,...r.typography.mediumAvatar,transition:"all .2s ease-in-out",background:r.palette.success.light,color:r.palette.success.dark,ml:1,"&:hover":{background:r.palette.success.dark,color:r.palette.success.light}},color:"inherit",onClick:()=>{if(t.id){const e={name:p.current.value};J.request(t.id,e)}},children:(0,F.jsx)(Y.kk6,{stroke:1.5,size:"1.3rem"})})}),(0,F.jsx)(Z.c,{title:"Cancel",sx:{borderRadius:"50%"},children:(0,F.jsx)($.c,{variant:"rounded",sx:{...r.typography.commonAvatar,...r.typography.mediumAvatar,transition:"all .2s ease-in-out",background:r.palette.error.light,color:r.palette.error.dark,ml:1,"&:hover":{background:r.palette.error.dark,color:r.palette.error.light}},color:"inherit",onClick:()=>x(!1),children:(0,F.jsx)(Y.KgB,{stroke:1.5,size:"1.3rem"})})})]})]}),(0,F.jsxs)(h.c,{children:[(null===t||void 0===t?void 0:t.id)&&(0,F.jsx)(Z.c,{title:"API Endpoint",sx:{borderRadius:"50%",mr:2},children:(0,F.jsx)($.c,{variant:"rounded",sx:{...r.typography.commonAvatar,...r.typography.mediumAvatar,transition:"all .2s ease-in-out",background:r.palette.canvasHeader.deployLight,color:r.palette.canvasHeader.deployDark,"&:hover":{background:r.palette.canvasHeader.deployDark,color:r.palette.canvasHeader.deployLight}},color:"inherit",onClick:()=>{let e=!1;try{const a=JSON.parse(t.flowData).nodes;for(const t of a)if(t.data.inputParams.find((e=>"file"===e.type))){e=!0;break}}catch(n){console.error(n)}let a=!1;try{const e=JSON.parse(t.flowData).nodes;for(const t of e)if(t.data.inputParams.find((e=>"sessionId"===e.name))){a=!0;break}}catch(n){console.error(n)}I({title:"Embed in website or use as API",chatflowid:t.id,chatflowApiKeyId:t.apikeyid,isFormDataRequired:e,isSessionMemory:a}),D(!0)},children:(0,F.jsx)(Y.y_m,{stroke:1.5,size:"1.3rem"})})}),(0,F.jsx)(Z.c,{title:"Save Chatflow",sx:{borderRadius:"50%",mr:2},children:(0,F.jsx)($.c,{variant:"rounded",sx:{...r.typography.commonAvatar,...r.typography.mediumAvatar,transition:"all .2s ease-in-out",background:r.palette.canvasHeader.saveLight,color:r.palette.canvasHeader.saveDark,"&:hover":{background:r.palette.canvasHeader.saveDark,color:r.palette.canvasHeader.saveLight}},color:"inherit",onClick:()=>{t.id?a(y):S(!0)},children:(0,F.jsx)(Y.CQG,{stroke:1.5,size:"1.3rem"})})}),(0,F.jsx)(Z.c,{ref:m,title:"Settings",sx:{borderRadius:"50%"},children:(0,F.jsx)($.c,{variant:"rounded",sx:{...r.typography.commonAvatar,...r.typography.mediumAvatar,transition:"all .2s ease-in-out",background:r.palette.canvasHeader.settingsLight,color:r.palette.canvasHeader.settingsDark,"&:hover":{background:r.palette.canvasHeader.settingsDark,color:r.palette.canvasHeader.settingsLight}},onClick:()=>b(!j),children:(0,F.jsx)(Y.e0,{stroke:1.5,size:"1.3rem"})})})]}),(0,F.jsx)(ue,{chatflow:t,isSettingsOpen:j,anchorEl:m.current,onClose:()=>b(!1),onSettingsItemClick:e=>{if(b(!1),"deleteChatflow"===e)o();else if("conversationStarters"===e)B({title:"Starter Prompts - "+t.name,chatflow:t}),E(!0);else if("analyseChatflow"===e)O({title:"Analyse Chatflow",chatflow:t}),P(!0);else if("viewMessages"===e)U({title:"View Messages",chatflow:t}),L(!0);else if("duplicateChatflow"===e)try{localStorage.setItem("duplicatedFlowData",t.flowData),window.open("".concat(z.wn,"/canvas"),"_blank")}catch(a){console.error(a)}else if("exportChatflow"===e)try{const e=JSON.parse(t.flowData);let a=JSON.stringify((0,Ze.us)(e),null,2),n="data:application/json;charset=utf-8,"+encodeURIComponent(a),o="".concat(t.name," Chatflow.json"),s=document.createElement("a");s.setAttribute("href",n),s.setAttribute("download",o),s.click()}catch(a){console.error(a)}},onUploadFile:e=>{b(!1),s(e)}}),(0,F.jsx)(pe.c,{show:C,dialogProps:{title:"Save New Chatflow",confirmButtonName:"Save",cancelButtonName:"Cancel"},onCancel:()=>S(!1),onConfirm:e=>{S(!1),a(e)}}),(0,F.jsx)(tt,{show:k,dialogProps:T,onCancel:()=>D(!1)}),(0,F.jsx)(dt,{show:A,dialogProps:M,onCancel:()=>P(!1)}),(0,F.jsx)(Ft.c,{show:N,dialogProps:R,onConfirm:()=>E(!1),onCancel:()=>E(!1)}),(0,F.jsx)(qt,{show:q,dialogProps:H,onCancel:()=>L(!1)})]})};var zt=a(69040),Ht=a(42966);const Ut=(0,x.cp)(Ht.c)((e=>{let{theme:t,color:a="primary"}=e;return{color:"white",backgroundColor:t.palette[a].main,"&:hover":{backgroundColor:t.palette[a].main,backgroundImage:"linear-gradient(rgb(0 0 0/10%) 0 0)"}}})),Jt=e=>{let{nodesData:t,node:a}=e;const o=(0,g.c)(),s=(0,i.w1)((e=>e.customization)),r=(0,i.OY)(),[c,l]=(0,n.useState)(""),[u,p]=(0,n.useState)({}),[m,f]=(0,n.useState)(!1),[x,y]=(0,n.useState)({}),j=(0,n.useRef)(null),b=(0,n.useRef)(m),S=(0,n.useRef)(),k=()=>{const e=S.current;e&&(e.scrollTop=0)},D=e=>{l(e),setTimeout((()=>{if(e){const a=(e=>t.filter((t=>{const a=t.name.toLowerCase().includes(e.toLowerCase()),n=t.category.toLowerCase().includes(e.toLowerCase());return a||n})))(e);T(a,!0),k()}else""===e&&(T(t),k())}),500)},T=(e,t)=>{const a={},n=e.reduce((function(e,n){return e[n.category]=e[n.category]||[],e[n.category].push(n),a[n.category]=!!t,e}),Object.create(null));p(n),((e,t,a)=>{var n;const o={...e},s=null!==(n=o["Vector Stores"])&&void 0!==n?n:[],r=[],i=[];for(const c of s)"DEPRECATING"===c.badge?r.push(c):i.push(c);delete o["Vector Stores"],r.length&&(o["Vector Stores;DEPRECATING"]=r,t["Vector Stores;DEPRECATING"]=!!a),i.length&&(o["Vector Stores;NEW"]=i,t["Vector Stores;NEW"]=!!a),p(o)})(n,a,t),y(a)},I=e=>(t,a)=>{const n={...x};n[e]=a,y(n)},A=e=>{j.current&&j.current.contains(e.target)||f(!1)};return(0,n.useEffect)((()=>{!0===b.current&&!1===m&&j.current.focus(),b.current=m}),[m]),(0,n.useEffect)((()=>{a&&f(!1)}),[a]),(0,n.useEffect)((()=>{t&&(T(t),r({type:d.bJ,componentNodes:t}))}),[t,r]),(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)(Ut,{sx:{left:20,top:20},ref:j,size:"small",color:"primary","aria-label":"add",title:"Add Node",onClick:()=>{f((e=>!e))},children:m?(0,F.jsx)(Y.ar0,{}):(0,F.jsx)(Y.SU7,{})}),(0,F.jsx)(ae.c,{placement:"bottom-end",open:m,anchorEl:j.current,role:void 0,transition:!0,disablePortal:!0,popperOptions:{modifiers:[{name:"offset",options:{offset:[-40,14]}}]},sx:{zIndex:1e3},children:e=>{let{TransitionProps:t}=e;return(0,F.jsx)(ie.c,{in:m,...t,children:(0,F.jsx)(O.c,{children:(0,F.jsx)(ne.q,{onClickAway:A,children:(0,F.jsxs)(C.c,{border:!1,elevation:16,content:!1,boxShadow:!0,shadow:o.shadows[16],children:[(0,F.jsxs)(h.c,{sx:{p:2},children:[(0,F.jsx)(ee.c,{children:(0,F.jsx)(v.c,{variant:"h4",children:"Add Nodes"})}),(0,F.jsx)(Ce.c,{sx:{width:"100%",pr:2,pl:2,my:2},id:"input-search-node",value:c,onChange:e=>D(e.target.value),placeholder:"Search nodes",startAdornment:(0,F.jsx)(zt.c,{position:"start",children:(0,F.jsx)(Y.OwM,{stroke:1.5,size:"1rem",color:o.palette.grey[500]})}),endAdornment:(0,F.jsx)(zt.c,{position:"end",sx:{cursor:"pointer",color:o.palette.grey[500],"&:hover":{color:o.palette.grey[900]}},title:"Clear Search",children:(0,F.jsx)(Y.KgB,{stroke:1.5,size:"1rem",onClick:()=>D(""),style:{cursor:"pointer"}})}),"aria-describedby":"search-helper-text",inputProps:{"aria-label":"weight"}}),(0,F.jsx)(w.c,{})]}),(0,F.jsx)(re(),{containerRef:e=>{S.current=e},style:{height:"100%",maxHeight:"calc(100vh - 320px)",overflowX:"hidden"},children:(0,F.jsx)(h.c,{sx:{p:2},children:(0,F.jsx)(oe.c,{sx:{width:"100%",maxWidth:370,py:0,borderRadius:"10px",[o.breakpoints.down("md")]:{maxWidth:370},"& .MuiListItemSecondaryAction-root":{top:22},"& .MuiDivider-root":{my:0},"& .list-container":{pl:7}},children:Object.keys(u).sort().map((e=>"Vector Stores"===e?(0,F.jsx)(F.Fragment,{}):(0,F.jsxs)(fe.c,{expanded:x[e]||!1,onChange:I(e),disableGutters:!0,children:[(0,F.jsx)(ge.c,{expandIcon:(0,F.jsx)(ve.c,{}),"aria-controls":"nodes-accordian-".concat(e),id:"nodes-accordian-header-".concat(e),children:e.split(";").length>1?(0,F.jsxs)("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:[(0,F.jsx)(v.c,{variant:"h5",children:e.split(";")[0]}),"\xa0",(0,F.jsx)(vt.c,{sx:{width:"max-content",fontWeight:700,fontSize:"0.65rem",background:"DEPRECATING"===e.split(";")[1]?o.palette.warning.main:o.palette.teal.main,color:"DEPRECATING"!==e.split(";")[1]?"white":"inherit"},size:"small",label:e.split(";")[1]})]}):(0,F.jsx)(v.c,{variant:"h5",children:e})}),(0,F.jsx)(xe.c,{children:u[e].map(((t,a)=>(0,F.jsxs)("div",{onDragStart:e=>((e,t)=>{e.dataTransfer.setData("application/reactflow",JSON.stringify(t)),e.dataTransfer.effectAllowed="move"})(e,t),draggable:!0,children:[(0,F.jsx)(yt.c,{sx:{p:0,borderRadius:"".concat(s.borderRadius,"px"),cursor:"move"},children:(0,F.jsxs)(at.cp,{alignItems:"center",children:[(0,F.jsx)(nt.c,{children:(0,F.jsx)("div",{style:{width:50,height:50,borderRadius:"50%",backgroundColor:"white"},children:(0,F.jsx)("img",{style:{width:"100%",height:"100%",padding:10,objectFit:"contain"},alt:t.name,src:"".concat(z.OM,"/api/v1/node-icon/").concat(t.name)})})}),(0,F.jsx)(ot.c,{sx:{ml:1},primary:(0,F.jsxs)("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:[(0,F.jsx)("span",{children:t.label}),"\xa0",t.badge&&(0,F.jsx)(vt.c,{sx:{width:"max-content",fontWeight:700,fontSize:"0.65rem",background:"DEPRECATING"===t.badge?o.palette.warning.main:o.palette.teal.main,color:"DEPRECATING"!==t.badge?"white":"inherit"},size:"small",label:t.badge})]}),secondary:t.description})]})}),a===u[e].length-1?null:(0,F.jsx)(w.c,{})]},t.name)))})]},e)))})})})]})})})})}})]})};var Kt=a(31128),Wt=a(41264),Yt=a(74996);const _t=(e,t)=>H.c.post("/internal-prediction/".concat(e),t),Gt=e=>{let{isGrid:t,starterPrompts:a,onPromptClick:n}=e;return(0,F.jsx)(h.c,{className:"button-container",sx:{maxWidth:t?"inherit":"400px",m:1},children:a.map(((e,t)=>(0,F.jsx)(vt.c,{label:e.prompt,className:"button",onClick:t=>n(e.prompt,t)},t)))})},Xt=e=>{let{open:t,chatflowid:a,isDialog:o}=e;const s=(0,g.c)(),r=(0,i.w1)((e=>e.customization)),c=(0,n.useRef)(),[l,d]=(0,n.useState)(""),[m,f]=(0,n.useState)(!1),[x,v]=(0,n.useState)([{message:"Hi there! How can I help?",type:"apiMessage"}]),[j,b]=(0,n.useState)(""),[C,S]=(0,n.useState)(!1),[k,D]=(0,n.useState)(!1),[T,I]=(0,n.useState)({}),[A,P]=(0,n.useState)(void 0),M=(0,n.useRef)(null),O=(0,K.c)(Mt),N=(0,K.c)(Te.c.getIsChatflowStreaming),E=(0,K.c)(Te.c.getSpecificChatflow),[R,B]=(0,n.useState)([]),q=(e,t)=>{I({data:e,title:t}),D(!0)},L=()=>{c.current&&c.current.scrollTo({top:z.kl})},H=(0,n.useCallback)((e=>d(e.target.value)),[d]),U=e=>{v((t=>{let a=[...(0,u.cloneDeep)(t)];return"userMessage"===a[a.length-1].type||(a[a.length-1].message+=e),a}))},J=e=>{v((t=>{let a=[...(0,u.cloneDeep)(t)];return"userMessage"===a[a.length-1].type||(a[a.length-1].sourceDocuments=e),a}))},W=async(e,t)=>{if(e&&e.preventDefault(),!t&&""===l.trim())return;let n=l;void 0!==t&&""!==t.trim()&&(n=t),f(!0),v((e=>[...e,{message:n,type:"userMessage"}]));try{const e={question:n,history:x.filter((e=>"Hi there! How can I help?"!==e.message)),chatId:A};C&&(e.socketIOClientId=j);const t=await _t(a,e);if(t.data){const e=t.data;if(A||P(e.chatId),!C){let t="";t=e.text?e.text:e.json?"```json\n"+JSON.stringify(e.json,null,2):JSON.stringify(e,null,2),v((a=>[...a,{message:t,sourceDocuments:null===e||void 0===e?void 0:e.sourceDocuments,usedTools:null===e||void 0===e?void 0:e.usedTools,fileAnnotations:null===e||void 0===e?void 0:e.fileAnnotations,type:"apiMessage"}]))}(0,Ze._W)(a,e.chatId,x),f(!1),d(""),setTimeout((()=>{var e;null===(e=M.current)||void 0===e||e.focus(),L()}),100)}}catch(o){return void function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Oops! There seems to be an error. Please try again.";e=e.replace("Unable to parse JSON response from chat agent.\n\n",""),v((t=>[...t,{message:e,type:"apiMessage"}])),f(!1),d(""),setTimeout((()=>{var e;null===(e=M.current)||void 0===e||e.focus()}),100)}(o.response.data||"".concat(o.response.status,": ").concat(o.response.statusText))}};return(0,n.useEffect)((()=>{var e;if(null!==(e=O.data)&&void 0!==e&&e.length){var t;const e=null===(t=O.data[0])||void 0===t?void 0:t.chatId;P(e);const n=O.data.map((e=>{const t={message:e.content,type:e.role};return e.sourceDocuments&&(t.sourceDocuments=JSON.parse(e.sourceDocuments)),e.usedTools&&(t.usedTools=JSON.parse(e.usedTools)),e.fileAnnotations&&(t.fileAnnotations=JSON.parse(e.fileAnnotations)),t}));v((e=>[...e,...n])),(0,Ze._W)(a,e,x)}}),[O.data]),(0,n.useEffect)((()=>{var e,t;N.data&&S(null!==(e=null===(t=N.data)||void 0===t?void 0:t.isStreaming)&&void 0!==e&&e)}),[N.data]),(0,n.useEffect)((()=>{var e,t;if(E.data&&(null!==(e=E.data)&&void 0!==e&&e.chatbotConfig&&JSON.parse(null===(t=E.data)||void 0===t?void 0:t.chatbotConfig))){var a;let e=JSON.parse(null===(a=E.data)||void 0===a?void 0:a.chatbotConfig);if(e.starterPrompts){let t=[];Object.getOwnPropertyNames(e.starterPrompts).forEach((a=>{e.starterPrompts[a]&&t.push(e.starterPrompts[a])})),B(t)}}}),[E.data]),(0,n.useEffect)((()=>{L()}),[x]),(0,n.useEffect)((()=>{o&&M&&setTimeout((()=>{var e;null===(e=M.current)||void 0===e||e.focus()}),100)}),[o,M]),(0,n.useEffect)((()=>{let e;return t&&a&&(O.request(a),N.request(a),E.request(a),L(),e=(0,Wt.cp)(z.OM),e.on("connect",(()=>{b(e.id)})),e.on("start",(()=>{v((e=>[...e,{message:"",type:"apiMessage"}]))})),e.on("sourceDocuments",J),e.on("token",U)),()=>{d(""),f(!1),v([{message:"Hi there! How can I help?",type:"apiMessage"}]),e&&(e.disconnect(),b(""))}}),[t,a]),(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)("div",{className:o?"cloud-dialog":"cloud",children:(0,F.jsx)("div",{ref:c,className:"messagelist",children:x&&x.map(((e,t)=>(0,F.jsx)(F.Fragment,{children:(0,F.jsxs)(h.c,{sx:{background:"apiMessage"===e.type?s.palette.asyncSelect.main:""},style:{display:"flex"},className:"userMessage"===e.type&&m&&t===x.length-1?r.isDarkMode?"usermessagewaiting-dark":"usermessagewaiting-light":"usermessagewaiting"===e.type?"apimessage":"usermessage",children:["apiMessage"===e.type?(0,F.jsx)("img",{src:bt,alt:"AI",width:"30",height:"30",className:"boticon"}):(0,F.jsx)("img",{src:Ct,alt:"Me",width:"30",height:"30",className:"usericon"}),(0,F.jsxs)("div",{style:{display:"flex",flexDirection:"column",width:"100%"},children:[e.usedTools&&(0,F.jsx)("div",{style:{display:"block",flexDirection:"row",width:"100%"},children:e.usedTools.map(((e,t)=>(0,F.jsx)(vt.c,{size:"small",label:e.tool,component:"a",sx:{mr:1,mt:1},variant:"outlined",clickable:!0,onClick:()=>q(e,"Used Tools")},t)))}),(0,F.jsx)("div",{className:"markdownanswer",children:(0,F.jsx)(kt.I,{remarkPlugins:[ft.c,gt.c],rehypePlugins:[ht.c,mt.c],components:{code(e){let{inline:t,className:n,children:s,...r}=e;const i=/language-(\w+)/.exec(n||"");return t?(0,F.jsx)("code",{className:n,...r,children:s}):(0,F.jsx)(Dt.s,{chatflowid:a,isDialog:o,language:i&&i[1]||"",value:String(s).replace(/\n$/,""),...r},Math.random())}},children:e.message})}),e.fileAnnotations&&(0,F.jsx)("div",{style:{display:"block",flexDirection:"row",width:"100%"},children:e.fileAnnotations.map(((e,t)=>(0,F.jsx)(p.c,{sx:{fontSize:"0.85rem",textTransform:"none",mb:1},variant:"outlined",onClick:()=>(async e=>{try{const t=await xt.c.post("".concat(z.OM,"/api/v1/openai-assistants-file"),{fileName:e.fileName},{responseType:"blob"}),a=new Blob([t.data],{type:t.headers["content-type"]}),n=window.URL.createObjectURL(a),o=document.createElement("a");o.href=n,o.download=e.fileName,document.body.appendChild(o),o.click(),o.remove()}catch(t){console.error("Download failed:",t)}})(e),endIcon:(0,F.jsx)(Y.snM,{color:s.palette.primary.main}),children:e.fileName},t)))}),e.sourceDocuments&&(0,F.jsx)("div",{style:{display:"block",flexDirection:"row",width:"100%"},children:(0,Ze.eA)(e).map(((e,t)=>{const a=e.metadata&&e.metadata.source?(0,Ze.a)(e.metadata.source):void 0;return(0,F.jsx)(vt.c,{size:"small",label:a?"/"===a.pathname.substring(0,15)?a.host:"".concat(a.pathname.substring(0,15),"..."):"".concat(e.pageContent.substring(0,15),"..."),component:"a",sx:{mr:1,mb:1},variant:"outlined",clickable:!0,onClick:()=>{return a?(t=e.metadata.source,void window.open(t,"_blank")):q(e);var t}},t)}))})]})]},t)})))})}),(0,F.jsxs)("div",{style:{position:"relative"},children:[x&&1===x.length&&(0,F.jsx)(Gt,{starterPrompts:R||[],onPromptClick:async e=>{d(e),W(void 0,e)},isGrid:o}),(0,F.jsx)(w.c,{})]}),(0,F.jsx)("div",{className:"center",children:(0,F.jsx)("div",{style:{width:"100%"},children:(0,F.jsx)("form",{style:{width:"100%"},onSubmit:W,children:(0,F.jsx)(Ce.c,{inputRef:M,autoFocus:!0,sx:{width:"100%"},disabled:m||!a,onKeyDown:e=>{const t=e.isComposing||229===e.keyCode;"Enter"===e.key&&l&&!t?!e.shiftKey&&l&&W(e):"Enter"===e.key&&e.preventDefault()},id:"userInput",name:"userInput",placeholder:m?"Waiting for response...":"Type your question...",value:l,onChange:H,multiline:!0,maxRows:o?7:2,endAdornment:(0,F.jsx)(zt.c,{position:"end",sx:{padding:"15px"},children:(0,F.jsx)(y.c,{type:"submit",disabled:m||!a,edge:"end",children:m?(0,F.jsx)("div",{children:(0,F.jsx)(Yt.c,{color:"inherit",size:20})}):(0,F.jsx)(Y.svN,{color:m||!a?"#9e9e9e":r.isDarkMode?"white":"#1e88e5"})})})})})})}),(0,F.jsx)(At,{show:k,dialogProps:T,onCancel:()=>D(!1)})]})},Vt=e=>{let{show:t,dialogProps:a,onClear:n,onCancel:o}=e;const s=document.getElementById("portal"),r=(0,i.w1)((e=>e.customization)),c=t?(0,F.jsxs)(I.c,{open:t,fullWidth:!0,maxWidth:"md",onClose:o,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",sx:{overflow:"visible"},children:[(0,F.jsx)(A.c,{sx:{fontSize:"1rem"},id:"alert-dialog-title",children:(0,F.jsxs)("div",{style:{display:"flex",flexDirection:"row"},children:[a.title,(0,F.jsx)("div",{style:{flex:1}}),r.isDarkMode&&(0,F.jsx)(ke.y,{variant:"outlined",color:"error",title:"Clear Conversation",onClick:n,startIcon:(0,F.jsx)(Y.ukq,{}),children:"Clear Chat"}),!r.isDarkMode&&(0,F.jsx)(p.c,{variant:"outlined",color:"error",title:"Clear Conversation",onClick:n,startIcon:(0,F.jsx)(Y.ukq,{}),children:"Clear Chat"})]})}),(0,F.jsx)(P.c,{sx:{display:"flex",justifyContent:"flex-end",flexDirection:"column"},children:(0,F.jsx)(Xt,{isDialog:!0,open:a.open,chatflowid:a.chatflowid})})]}):null;return(0,T.createPortal)(c,s)},Qt=e=>{let{chatflowid:t}=e;const a=(0,g.c)(),{confirm:o}=(0,Rt.c)(),s=(0,i.OY)();(0,Ie.c)();const r=function(){return s((0,d.mq)(...arguments))},c=function(){return s((0,d.EF)(...arguments))},[l,u]=(0,n.useState)(!1),[h,m]=(0,n.useState)(!1),[f,x]=(0,n.useState)({}),y=(0,n.useRef)(null),v=(0,n.useRef)(l),w=e=>{y.current&&y.current.contains(e.target)||u(!1)},j=async()=>{if(await o({title:"Clear Chat History",description:"Are you sure you want to clear all chat history?",confirmButtonName:"Clear",cancelButtonName:"Cancel"}))try{const e=localStorage.getItem("".concat(t,"_INTERNAL"));if(!e)return;const a=JSON.parse(e);await Et(t,{chatId:a.chatId,chatType:"INTERNAL"}),localStorage.removeItem("".concat(t,"_INTERNAL")),(()=>{const e={...f,open:!1};x(e),setTimeout((()=>{const e={...f,open:!0};x(e)}),500)})(),r({message:"Succesfully cleared all chat history",options:{key:(new Date).getTime()+Math.random(),variant:"success",action:e=>(0,F.jsx)(p.c,{style:{color:"white"},onClick:()=>c(e),children:(0,F.jsx)(Y.KgB,{})})}})}catch(e){const t=e.response.data||"".concat(e.response.status,": ").concat(e.response.statusText);r({message:t,options:{key:(new Date).getTime()+Math.random(),variant:"error",persist:!0,action:e=>(0,F.jsx)(p.c,{style:{color:"white"},onClick:()=>c(e),children:(0,F.jsx)(Y.KgB,{})})}})}};return(0,n.useEffect)((()=>{!0===v.current&&!1===l&&y.current.focus(),v.current=l}),[l,t]),(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)(Ut,{sx:{position:"absolute",right:20,top:20},ref:y,size:"small",color:"secondary","aria-label":"chat",title:"Chat",onClick:()=>{u((e=>!e))},children:l?(0,F.jsx)(Y.KgB,{}):(0,F.jsx)(Y.u4t,{})}),l&&(0,F.jsx)(Ut,{sx:{position:"absolute",right:80,top:20},onClick:j,size:"small",color:"error","aria-label":"clear",title:"Clear Chat History",children:(0,F.jsx)(Y.ukq,{})}),l&&(0,F.jsx)(Ut,{sx:{position:"absolute",right:140,top:20},onClick:()=>{x({open:!0,chatflowid:t}),m(!0)},size:"small",color:"primary","aria-label":"expand",title:"Expand Chat",children:(0,F.jsx)(Y.oxS,{})}),(0,F.jsx)(ae.c,{placement:"bottom-end",open:l,anchorEl:y.current,role:void 0,transition:!0,disablePortal:!0,popperOptions:{modifiers:[{name:"offset",options:{offset:[40,14]}}]},sx:{zIndex:1e3},children:e=>{let{TransitionProps:n}=e;return(0,F.jsx)(ie.c,{in:l,...n,children:(0,F.jsx)(O.c,{children:(0,F.jsx)(ne.q,{onClickAway:w,children:(0,F.jsx)(C.c,{border:!1,elevation:16,content:!1,boxShadow:!0,shadow:a.shadows[16],children:(0,F.jsx)(Xt,{chatflowid:t,open:l})})})})})}}),(0,F.jsx)(Vt,{show:h,dialogProps:f,onClear:j,onCancel:()=>m(!1)})]})};var Zt=a(53856);const $t=(e,t)=>H.c.post("/vector/internal-upsert/".concat(e),t);function ea(e){const{children:t,value:a,index:n,...o}=e;return(0,F.jsx)("div",{role:"tabpanel",hidden:a!==n,id:"attachment-tabpanel-".concat(n),"aria-labelledby":"attachment-tab-".concat(n),...o,children:a===n&&(0,F.jsx)(h.c,{sx:{p:1},children:t})})}function ta(e){return{id:"attachment-tab-".concat(e),"aria-controls":"attachment-tabpanel-".concat(e)}}const aa=e=>{let{show:t,dialogProps:a,onCancel:o}=e;const s=document.getElementById("portal"),{reactFlowInstance:r}=(0,n.useContext)(_.y),c=(0,i.OY)();(0,Ie.c)();const l=function(){return c((0,d.mq)(...arguments))},u=function(){return c((0,d.EF)(...arguments))},m=(0,K.c)(U),[f,g]=(0,n.useState)([]),[x,y]=(0,n.useState)(!1),[w,j]=(0,n.useState)({}),[b,C]=(0,n.useState)({}),[S,k]=(0,n.useState)({}),[D,M]=(0,n.useState)(0),[O,N]=(0,n.useState)(""),[E,R]=(0,n.useState)({}),B=(e,t,n,o)=>"Python"===e?'import requests\n\nAPI_URL = "'.concat(z.OM,"/api/v1/vector/upsert/").concat(a.chatflowid,'"\n\ndef query(payload):\n    response = requests.post(API_URL, json=payload)\n    return response.json()\n\noutput = query({\n    ').concat(n?'"stopNodeId": "'.concat(t,'",\n    '):"",'"overrideConfig": {').concat((0,Ze.Qv)(o,"json",n,t),"\n    }\n})\n"):"JavaScript"===e?'async function query(data) {\n    const response = await fetch(\n        "'.concat(z.OM,"/api/v1/vector/upsert/").concat(a.chatflowid,'",\n        {\n            method: "POST",\n            headers: {\n                "Content-Type": "application/json"\n            },\n            body: JSON.stringify(data)\n        }\n    );\n    const result = await response.json();\n    return result;\n}\n\nquery({\n  ').concat(n?'"stopNodeId": "'.concat(t,'",\n  '):"",'"overrideConfig": {').concat((0,Ze.Qf)(o,"json",n,t),"\n  }\n}).then((response) => {\n    console.log(response);\n});\n"):"cURL"===e?"curl ".concat(z.OM,"/api/v1/vector/upsert/").concat(a.chatflowid," \\\n      -X POST \\\n      ").concat(n?'-d \'{"stopNodeId": "'.concat(t,'", "overrideConfig": {').concat((0,Ze.qT)(o,"json",n,t),"}' \\"):'-d \'{"overrideConfig": {'.concat((0,Ze.qT)(o,"json",n,t),"}' \\"),'\n      -H "Content-Type: application/json"'):"",q=(e,t,n,o)=>{if("Python"===e){let e=(o=(0,Ze.s7)(o))[0].type;return e.includes(",")&&(e=e.split(",")[0]),'import requests\n\nAPI_URL = "'.concat(z.OM,"/api/v1/vector/upsert/").concat(a.chatflowid,'"\n\n# use form data to upload files\nform_data = {\n    "files": ',"('example".concat(e,"', open('example").concat(e,"', 'rb'))"),"\n}\nbody_data = {").concat((0,Ze.Qv)(o,"formData",n,t),"}\n\ndef query(form_data, body_data):\n    response = requests.post(API_URL, files=form_data, data=body_data)\n    return response.json()\n\noutput = query(form_data, body_data)\n")}return"JavaScript"===e?"// use FormData to upload files\nlet formData = new FormData();\n".concat((0,Ze.Qf)(o,"formData",n,t),'\nasync function query(formData) {\n    const response = await fetch(\n        "').concat(z.OM,"/api/v1/vector/upsert/").concat(a.chatflowid,'",\n        {\n            method: "POST",\n            body: formData\n        }\n    );\n    const result = await response.json();\n    return result;\n}\n\nquery(formData).then((response) => {\n    console.log(response);\n});\n'):"cURL"===e?"curl ".concat(z.OM,"/api/v1/vector/upsert/").concat(a.chatflowid," \\\n     -X POST \\").concat((0,Ze.qT)(o,"formData",n,t),' \\\n     -H "Content-Type: multipart/form-data"'):""},H=e=>"Python"===e?"python":"JavaScript"===e?"javascript":"cURL"===e?"bash":"python",J=e=>"Python"===e?We:"JavaScript"===e?Ye:"Embed"===e?EmbedSVG:"cURL"===e?_e:"Share Chatbot"===e?ShareChatbotSVG:"Configuration"===e?settingsSVG:We,W=e=>{const t=[],a=Object.keys(e.data.inputs);for(let o=0;o<e.data.inputParams.length;o+=1){var n;if(a.includes(e.data.inputParams[o].name))t.push({label:e.data.inputParams[o].label,name:e.data.inputParams[o].name,type:e.data.inputParams[o].type,value:"file"===e.data.inputParams[o].type?(0,Ze.O8)(e.data.inputs[e.data.inputParams[o].name]):null!==(n=e.data.inputs[e.data.inputParams[o].name])&&void 0!==n?n:""})}return t};(0,n.useEffect)((()=>{if(m.data){var e,t;const a={...E};a[O]=((e,t)=>e.filter((e=>t.some((t=>e.nodeId===t.id)))))(m.data,null!==(e=null===(t=f.find((e=>e.vectorNode.data.id===O)))||void 0===t?void 0:t.nodes)&&void 0!==e?e:[]),R(a)}}),[m.data]),(0,n.useEffect)((()=>{if(a&&r){const e=r.getNodes(),t=r.getEdges();g((0,Ze.k$)(e,t))}return()=>{g([]),y(!1),j({}),C({}),k({}),M(0),R({})}}),[a]),(0,n.useEffect)((()=>(c(t?{type:d.wp}:{type:d.OC}),()=>c({type:d.OC}))),[t,c]);const G=t?(0,F.jsxs)(I.c,{open:t,fullWidth:!0,maxWidth:"md",onClose:o,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",sx:{overflow:"visible"},children:[(0,F.jsx)(A.c,{sx:{fontSize:"1rem"},id:"alert-dialog-title",children:a.title}),(0,F.jsx)(P.c,{sx:{display:"flex",justifyContent:"flex-end",flexDirection:"column"},children:(0,F.jsx)(re(),{style:{height:"100%",maxHeight:"calc(100vh - 220px)",overflowX:"hidden"},children:f.length>0&&f.map(((e,t)=>(0,F.jsxs)("div",{children:[e.nodes.length>0&&e.nodes.map(((e,t)=>{return(0,F.jsxs)(fe.c,{expanded:b[e.data.id]||!1,onChange:(a=e.data.id,(e,t)=>{const n={...b};n[a]=t,C(n)}),disableGutters:!0,children:[(0,F.jsx)(ge.c,{expandIcon:(0,F.jsx)(ve.c,{}),"aria-controls":"nodes-accordian-".concat(e.data.name),id:"nodes-accordian-header-".concat(e.data.name),children:(0,F.jsxs)("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:[(0,F.jsx)("div",{style:{width:40,height:40,marginRight:10,borderRadius:"50%",backgroundColor:"white"},children:(0,F.jsx)("img",{style:{width:"100%",height:"100%",padding:7,borderRadius:"50%",objectFit:"contain"},alt:e.data.name,src:"".concat(z.OM,"/api/v1/node-icon/").concat(e.data.name)})}),(0,F.jsx)(v.c,{variant:"h5",children:e.data.label}),(0,F.jsx)("div",{style:{display:"flex",flexDirection:"row",width:"max-content",borderRadius:15,background:"rgb(254,252,191)",padding:5,paddingLeft:10,paddingRight:10,marginLeft:10},children:(0,F.jsx)("span",{style:{color:"rgb(116,66,16)",fontSize:"0.825rem"},children:e.data.id})})]})}),(0,F.jsx)(xe.c,{children:(0,F.jsx)(L,{sx:{minWidth:"max-content"},rows:W(e),columns:Object.keys(W(e)[0])})})]},t);var a})),(0,F.jsxs)(h.c,{sx:{p:2},children:[(0,F.jsx)(Fe,{label:"Show API",value:S[e.vectorNode.data.id],onChange:()=>(e=>{var t,n;const o={...S};Object.keys(o).includes(e)?o[e]=!o[e]:o[e]=!0,!0===o[e]&&m.request(a.chatflowid),k(o),N(e);const s={...w};s[e]=!1,j(s);const r=null!==(t=null===(n=f.find((t=>t.vectorNode.data.id===e)))||void 0===n?void 0:n.nodes)&&void 0!==t?t:[];for(const a of r)if(a.data.inputParams.find((e=>"file"===e.type))){s[e]=!0,j(s);break}})(e.vectorNode.data.id)},JSON.stringify(S)),S[e.vectorNode.data.id]&&(0,F.jsx)("div",{children:(0,F.jsx)(he.c,{value:D,onChange:(e,t)=>M(t),"aria-label":"tabs",children:["Python","JavaScript","cURL"].map(((e,t)=>(0,F.jsx)(me.c,{icon:(0,F.jsx)("img",{style:{objectFit:"cover",height:15,width:"auto"},src:J(e),alt:"code"}),iconPosition:"start",label:e,...ta(t)},t)))})}),S[e.vectorNode.data.id]&&void 0!==w[e.vectorNode.data.id]&&E[e.vectorNode.data.id]&&E[e.vectorNode.data.id].length>0&&(0,F.jsx)(F.Fragment,{children:(0,F.jsx)("div",{style:{marginTop:10},children:["Python","JavaScript","cURL"].map(((t,a)=>(0,F.jsx)(ea,{value:D,index:a,children:(0,F.jsx)(ye.UD,{theme:ye.ig,text:w[e.vectorNode.data.id]?q(t,e.vectorNode.data.id,f.length>1,E[e.vectorNode.data.id]):B(t,e.vectorNode.data.id,f.length>1,E[e.vectorNode.data.id]),language:H(t),showLineNumbers:!1,wrapLines:!0})},a)))})})]}),(0,F.jsxs)("div",{style:{marginBottom:"20px"},children:[x&&(0,F.jsx)(Zt.m,{open:x}),!x&&(0,F.jsx)(p.c,{sx:{color:"white"},fullWidth:!0,variant:"contained",color:"teal",title:"Upsert",onClick:()=>(async e=>{y(!0);try{await $t(a.chatflowid,{stopNodeId:e.data.id}),l({message:"Succesfully upserted vector store. You can start chatting now!",options:{key:(new Date).getTime()+Math.random(),variant:"success",action:e=>(0,F.jsx)(p.c,{style:{color:"white"},onClick:()=>u(e),children:(0,F.jsx)(Y.KgB,{})})}}),y(!1)}catch(t){const e=t.response.data||"".concat(t.response.status,": ").concat(t.response.statusText);l({message:e,options:{key:(new Date).getTime()+Math.random(),variant:"error",persist:!0,action:e=>(0,F.jsx)(p.c,{style:{color:"white"},onClick:()=>u(e),children:(0,F.jsx)(Y.KgB,{})})}}),y(!1)}})(e.vectorNode),children:"Upsert"})]})]},t)))})})]}):null;return(0,T.createPortal)(G,s)},na=e=>{let{chatflowid:t}=e;const a=(0,i.OY)();(0,Ie.c)();const o=function(){return a((0,d.mq)(...arguments))},s=function(){return a((0,d.EF)(...arguments))},[r,c]=(0,n.useState)(!1),[l,u]=(0,n.useState)(!1),[h,m]=(0,n.useState)({}),f=(0,n.useRef)(null),g=(0,n.useRef)(r);return(0,n.useEffect)((()=>{!0===g.current&&!1===r&&f.current.focus(),g.current=r}),[r,t]),(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)(Ut,{sx:{position:"absolute",right:80,top:20},ref:f,size:"small",color:"teal","aria-label":"upsert",title:"Upsert Vector Database",onClick:()=>{c((e=>!e));m({open:!0,title:"Upsert Vector Store",chatflowid:t}),u(!0)},children:r?(0,F.jsx)(Y.KgB,{}):(0,F.jsx)(Y.kwb,{})}),(0,F.jsx)(aa,{show:l,dialogProps:h,onUpsert:async()=>{try{await $t(t,{}),o({message:"Succesfully upserted vector store",options:{key:(new Date).getTime()+Math.random(),variant:"success",action:e=>(0,F.jsx)(p.c,{style:{color:"white"},onClick:()=>s(e),children:(0,F.jsx)(Y.KgB,{})})}})}catch(e){const t=e.response.data||"".concat(e.response.status,": ").concat(e.response.statusText);o({message:t,options:{key:(new Date).getTime()+Math.random(),variant:"error",persist:!0,action:e=>(0,F.jsx)(p.c,{style:{color:"white"},onClick:()=>s(e),children:(0,F.jsx)(Y.KgB,{})})}})}},onCancel:()=>{u(!1),c((e=>!e))}})]})},oa=()=>H.c.get("/nodes"),sa={customNode:V},ra={buttonedge:Q},ia=()=>{const e=(0,g.c)(),t=(0,c.i6)(),{state:a}=(0,c.IT)(),x=a?a.templateFlowData:"",y=document.location.pathname.toString().split("/"),v="canvas"===y[y.length-1]?"":y[y.length-1],{confirm:w}=(0,Rt.c)(),j=(0,i.OY)(),b=(0,i.w1)((e=>e.canvas)),[C,S]=(0,n.useState)(b),[k,D]=(0,n.useState)(null),{reactFlowInstance:T,setReactFlowInstance:I}=(0,n.useContext)(_.y);(0,Ie.c)();const A=function(){return j((0,d.mq)(...arguments))},P=function(){return j((0,d.EF)(...arguments))},[M,O,N]=(0,o.wn)(),[E,R,B]=(0,o.lu)(),[q,L]=(0,n.useState)(null),[H,U]=(0,n.useState)(!1),J=(0,n.useRef)(null),W=(0,K.c)(oa),G=(0,K.c)(Te.c.createNewChatflow),X=(0,K.c)(Te.c.testChatflow),V=(0,K.c)(Te.c.updateChatflow),Q=(0,K.c)(Te.c.getSpecificChatflow),Z=e=>{try{const t=JSON.parse(e),a=t.nodes||[];O(a),R(t.edges||[]),oe()}catch(t){console.error(t)}},$=(0,n.useCallback)(((e,t)=>{L(t),O((e=>e.map((e=>(e.id===t.id?e.data={...e.data,selected:!0}:e.data={...e.data,selected:!1},e)))))})),ee=(0,n.useCallback)((e=>{e.preventDefault(),e.dataTransfer.dropEffect="move"}),[]),te=(0,n.useCallback)((e=>{e.preventDefault();const t=J.current.getBoundingClientRect();let a=e.dataTransfer.getData("application/reactflow");if("undefined"===typeof a||!a)return;a=JSON.parse(a);const n=T.project({x:e.clientX-t.left-100,y:e.clientY-t.top-50}),o=(0,Ze.KS)(a,T.getNodes()),s={id:o,position:n,type:"customNode",data:(0,Ze.oj)(a,o)};L(s),O((e=>e.concat(s).map((e=>(e.id===s.id?e.data={...e.data,selected:!0}:e.data={...e.data,selected:!1},e))))),setTimeout((()=>oe()),0)}),[T]),ae=()=>{j({type:d.sh}),A({message:"Chatflow saved",options:{key:(new Date).getTime()+Math.random(),variant:"success",action:e=>(0,F.jsx)(p.c,{style:{color:"white"},onClick:()=>P(e),children:(0,F.jsx)(Y.KgB,{})})}})},ne=e=>{A({message:e,options:{key:(new Date).getTime()+Math.random(),variant:"error",persist:!0,action:e=>(0,F.jsx)(p.c,{style:{color:"white"},onClick:()=>P(e),children:(0,F.jsx)(Y.KgB,{})})}})},oe=()=>{j({type:d.LA})};return(0,n.useEffect)((()=>{if(Q.data){const e=Q.data,t=e.flowData?JSON.parse(e.flowData):[];O(t.nodes||[]),R(t.edges||[]),j({type:d.kT,chatflow:e})}else if(Q.error){const e=Q.error,t=e.response.data||"".concat(e.response.status,": ").concat(e.response.statusText);ne("Failed to retrieve chatflow: ".concat(t))}}),[Q.data,Q.error]),(0,n.useEffect)((()=>{if(G.data){const e=G.data;j({type:d.kT,chatflow:e}),ae(),window.history.replaceState(null,null,"/canvas/".concat(e.id))}else if(G.error){const e=G.error,t=e.response.data||"".concat(e.response.status,": ").concat(e.response.statusText);ne("Failed to save chatflow: ".concat(t))}}),[G.data,G.error]),(0,n.useEffect)((()=>{if(V.data)j({type:d.kT,chatflow:V.data}),ae();else if(V.error){const e=V.error,t=e.response.data||"".concat(e.response.status,": ").concat(e.response.statusText);ne("Failed to save chatflow: ".concat(t))}}),[V.data,V.error]),(0,n.useEffect)((()=>{X.error&&A({message:"Test chatflow failed",options:{key:(new Date).getTime()+Math.random(),variant:"error",persist:!0,action:e=>(0,F.jsx)(p.c,{style:{color:"white"},onClick:()=>P(e),children:(0,F.jsx)(Y.KgB,{})})}})}),[X.error]),(0,n.useEffect)((()=>{if(D(C.chatflow),C.chatflow){const e=C.chatflow.flowData?JSON.parse(C.chatflow.flowData):[];((e,t)=>{(0,Ze.k$)(e,t).length?U(!0):U(!1)})(e.nodes||[],e.edges||[])}}),[C.chatflow]),(0,n.useEffect)((()=>(v?Q.request(v):(localStorage.getItem("duplicatedFlowData")?(Z(localStorage.getItem("duplicatedFlowData")),setTimeout((()=>localStorage.removeItem("duplicatedFlowData")),0)):(O([]),R([])),j({type:d.kT,chatflow:{name:"Untitled chatflow"}})),W.request(),()=>{setTimeout((()=>j({type:d.sh})),0)})),[]),(0,n.useEffect)((()=>{S(b)}),[b]),(0,n.useEffect)((()=>{function e(e){const t=e.clipboardData.getData("text");t.includes('{"nodes":[')&&t.includes('],"edges":[')&&Z(t)}return window.addEventListener("paste",e),()=>{window.removeEventListener("paste",e)}}),[]),(0,n.useEffect)((()=>{x&&x.includes('"nodes":[')&&x.includes('],"edges":[')&&Z(x)}),[x]),l("You have unsaved changes! Do you want to navigate away?",C.isDirty),(0,F.jsx)(F.Fragment,{children:(0,F.jsxs)(h.c,{children:[(0,F.jsx)(m.c,{enableColorOnDark:!0,position:"fixed",color:"inherit",elevation:1,sx:{bgcolor:e.palette.background.default},children:(0,F.jsx)(f.c,{children:(0,F.jsx)(Lt,{chatflow:k,handleSaveFlow:e=>{if(T){const t=T.getNodes().map((e=>{const t=(0,u.cloneDeep)(e.data);return Object.prototype.hasOwnProperty.call(t.inputs,z.SI)&&(t.credential=t.inputs[z.SI],t.inputs=(0,u.omit)(t.inputs,[z.SI])),e.data={...t,selected:!1},e})),a=T.toObject();a.nodes=t;const n=JSON.stringify(a);if(k.id){const t={name:e,flowData:n};V.request(k.id,t)}else{const t={name:e,deployed:!1,isPublic:!1,flowData:n};G.request(t)}}},handleDeleteFlow:async()=>{const e={title:"Delete",description:"Delete chatflow ".concat(k.name,"?"),confirmButtonName:"Delete",cancelButtonName:"Cancel"};if(await w(e))try{await Te.c.deleteChatflow(k.id),localStorage.removeItem("".concat(k.id,"_INTERNAL")),t("/")}catch(a){const e=a.response.data||"".concat(a.response.status,": ").concat(a.response.statusText);A({message:e,options:{key:(new Date).getTime()+Math.random(),variant:"error",persist:!0,action:e=>(0,F.jsx)(p.c,{style:{color:"white"},onClick:()=>P(e),children:(0,F.jsx)(Y.KgB,{})})}})}},handleLoadFlow:Z})})}),(0,F.jsx)(h.c,{sx:{pt:"70px",height:"100vh",width:"100%"},children:(0,F.jsx)("div",{className:"reactflow-parent-wrapper",children:(0,F.jsx)("div",{className:"reactflow-wrapper",ref:J,children:(0,F.jsxs)(o.UX,{nodes:M,edges:E,onNodesChange:N,onNodeClick:$,onEdgesChange:B,onDrop:te,onDragOver:ee,onNodeDragStop:oe,nodeTypes:sa,edgeTypes:ra,onConnect:e=>{const t={...e,type:"buttonedge",id:"".concat(e.source,"-").concat(e.sourceHandle,"-").concat(e.target,"-").concat(e.targetHandle),data:{label:(0,Ze.me)(e.sourceHandle)}},a=e.targetHandle.split("-")[0],n=e.sourceHandle.split("-")[0],s=e.targetHandle.split("-")[2];O((e=>e.map((e=>{if(e.id===a){let t;setTimeout((()=>oe()),0);const a=e.data.inputAnchors.find((e=>e.name===s)),o=e.data.inputParams.find((e=>e.name===s));if(a&&a.list){const a=e.data.inputs[s]||[];"tools"===s?(0,Ze.mM)(a,n):a.push("{{".concat(n,".data.instance}}")),t=a}else t=o&&o.acceptVariable?e.data.inputs[s]||"":"{{".concat(n,".data.instance}}");e.data={...e.data,inputs:{...e.data.inputs,[s]:t}}}return e})))),R((e=>(0,o.Wq)(t,e)))},onInit:I,fitView:!0,deleteKeyCode:b.canvasDialogShow?null:["Backspace","Delete"],minZoom:.1,children:[(0,F.jsx)(s.O,{style:{display:"flex",flexDirection:"row",left:"50%",transform:"translate(-50%, -50%)"}}),(0,F.jsx)(r.y,{color:"#aaa",gap:16}),(0,F.jsx)(Jt,{nodesData:W.data,node:q}),H&&(0,F.jsx)(na,{chatflowid:v}),(0,F.jsx)(Qt,{chatflowid:v})]})})})}),(0,F.jsx)(Kt.c,{})]})})}}}]);
//# sourceMappingURL=2572.534eca9f.chunk.js.map